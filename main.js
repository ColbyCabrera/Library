/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};function i(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function u(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var c=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(c(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!==a){var h=s<<4&240|a>>2;if(r.push(h),64!==u){var l=a<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},l=function(t){return function(t){var e=c(t);return h.encodeByteArray(e,!0)}(t).replace(/\./g,"")};function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=f(t[n],e[n]));return t}var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}var v=function(t){function e(n,r,i){var o=t.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,g.prototype.create),o}return n(e,t),e}(Error),g=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,e){return t.replace(m,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").";return new v(i,a,r)},t}(),m=/\{\$([^}]+)}/g;function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function w(t,e){var n=new E(t,e);return n.subscribe.bind(n)}!function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782),i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t}}();var E=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n},void 0===r.next&&(r.next=I),void 0===r.error&&(r.error=I),void 0===r.complete&&(r.complete=I);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function I(){}function _(t){return t&&t._delegate?t._delegate:t}var T,S=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),A="[DEFAULT]",N=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return t.prototype.get=function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new p;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e,n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:A})}catch(t){}try{for(var r=s(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=a(i.value,2),u=o[0],c=o[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService({instanceIdentifier:h});c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t=A),this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(u(u([],a(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),a(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t=A),this.instances.has(t)},t.prototype.getOptions=function(t){return void 0===t&&(t=A),this.instancesOptions.get(t)||{}},t.prototype.initialize=function(t){var e,n;void 0===t&&(t={});var r=t.options,i=void 0===r?{}:r,o=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(o))throw Error(this.name+"("+o+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var u=this.getOrInitializeService({instanceIdentifier:o,options:i});try{for(var c=s(this.instancesDeferred.entries()),h=c.next();!h.done;h=c.next()){var l=a(h.value,2),f=l[0],p=l[1];o===this.normalizeInstanceIdentifier(f)&&p.resolve(u)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}return u},t.prototype.onInit=function(t,e){var n,r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&t(o,r),function(){i.delete(t)}},t.prototype.invokeOnInitCallbacks=function(t,e){var n,r,i=this.onInitCallbacks.get(e);if(i)try{for(var o=s(i),a=o.next();!a.done;a=o.next()){var u=a.value;try{u(t,e)}catch(t){}}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===A?void 0:e),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(t){}return o||null},t.prototype.normalizeInstanceIdentifier=function(t){return void 0===t&&(t=A),this.component?this.component.multipleInstances?t:A:t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}(),D=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new N(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();function C(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var k,x=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(k||(k={}));var R,O={debug:k.DEBUG,verbose:k.VERBOSE,info:k.INFO,warn:k.WARN,error:k.ERROR,silent:k.SILENT},L=k.INFO,P=((T={})[k.DEBUG]="log",T[k.VERBOSE]="log",T[k.INFO]="info",T[k.WARN]="warn",T[k.ERROR]="error",T),M=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=P[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,C(["["+i+"]  "+t.name+":"],n))}},F=function(){function t(t){this.name=t,this._logLevel=L,this._logHandler=M,this._userLogHandler=null,x.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in k))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?O[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.DEBUG],t)),this._logHandler.apply(this,C([this,k.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.VERBOSE],t)),this._logHandler.apply(this,C([this,k.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.INFO],t)),this._logHandler.apply(this,C([this,k.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.WARN],t)),this._logHandler.apply(this,C([this,k.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.ERROR],t)),this._logHandler.apply(this,C([this,k.ERROR],t))},t}();function V(t){x.forEach((function(e){e.setLogLevel(t)}))}var U,q=((R={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",R["bad-app-name"]="Illegal App name: '{$appName}",R["duplicate-app"]="Firebase App named '{$appName}' already exists",R["app-deleted"]="Firebase App named '{$appName}' already deleted",R["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",R["invalid-log-argument"]="First argument to `onLog` must be null or a function.",R),j=new g("app","Firebase",q),B="@firebase/app",K="[DEFAULT]",z=((U={})[B]="fire-core",U["@firebase/analytics"]="fire-analytics",U["@firebase/app-check"]="fire-app-check",U["@firebase/auth"]="fire-auth",U["@firebase/database"]="fire-rtdb",U["@firebase/functions"]="fire-fn",U["@firebase/installations"]="fire-iid",U["@firebase/messaging"]="fire-fcm",U["@firebase/performance"]="fire-perf",U["@firebase/remote-config"]="fire-rc",U["@firebase/storage"]="fire-gcs",U["@firebase/firestore"]="fire-fst",U["fire-js"]="fire-js",U["firebase-wrapper"]="fire-js-all",U),G=new F("@firebase/app"),Q=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=f(void 0,t),this.container=new D(e.name),this._addComponent(new S("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(t){return r._addComponent(t)}))}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){var n;void 0===e&&(e=K),this.checkDestroyed_();var r=this.container.getProvider(t);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=K),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){G.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw j.create("app-deleted",{appName:this.name_})},t}();Q.prototype.name&&Q.prototype.options||Q.prototype.delete||console.log("dc");var H=function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=K);var s=o.name;if("string"!=typeof s||!s)throw j.create("bad-app-name",{appName:String(s)});if(b(e,s))throw j.create("duplicate-app",{appName:s});var a=new t(n,o,r);return e[s]=a,a},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=z[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&a&&u.push("and"),a&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void G.warn(u.join(" "))}o(new S(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:V,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw j.create("invalid-log-argument");!function(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=O[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:k[n].toLowerCase(),message:s,args:i,type:e.name})}},r=0,i=x;r<i.length;r++)n(i[r])}(t,e)},apps:null,SDK_VERSION:"8.10.0",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}};function i(t){if(!b(e,t=t||K))throw j.create("no-app",{appName:t});return e[t]}function o(o){var s=o.name;if(n.has(s))return G.debug("There were multiple attempts to register component "+s+"."),"PUBLIC"===o.type?r[s]:null;if(n.set(s,o),"PUBLIC"===o.type){var a=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[s])throw j.create("invalid-app-argument",{appName:s});return t[s]()};void 0!==o.serviceProps&&f(a,o.serviceProps),r[s]=a,t.prototype[s]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,s).apply(this,o.multipleInstances?t:[])}}for(var u=0,c=Object.keys(e);u<c.length;u++){var h=c[u];e[h]._addComponent(o)}return"PUBLIC"===o.type?r[s]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(Q);return e.INTERNAL=r(r({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){f(e,t)},createSubscribe:w,ErrorFactory:g,deepExtend:f}),e}(),W=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();if("object"==typeof self&&self.self===self&&void 0!==self.firebase){G.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var Y=self.firebase.SDK_VERSION;Y&&Y.indexOf("LITE")>=0&&G.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var X=H.initializeApp;H.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y()&&G.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),X.apply(void 0,t)};var $=H;!function(t,e){t.INTERNAL.registerComponent(new S("platform-logger",(function(t){return new W(t)}),"PRIVATE")),t.registerVersion(B,"0.6.30",void 0),t.registerVersion("fire-js","")}($);const J=$;var Z="8.10.1";J.registerVersion("firebase",Z,"app"),J.SDK_VERSION=Z;var tt=function(t,e){return tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},tt(t,e)};function et(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var nt,rt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},it=it||{},ot=rt||self;function st(){}function at(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function ut(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ct="closure_uid_"+(1e9*Math.random()>>>0),ht=0;function lt(t,e,n){return t.call.apply(t.bind,arguments)}function ft(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function pt(t,e,n){return(pt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?lt:ft).apply(null,arguments)}function dt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function yt(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function vt(){this.s=this.s,this.o=this.o}var gt={};vt.prototype.s=!1,vt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,ct)&&t[ct]||(t[ct]=++ht)}(this);delete gt[t]}},vt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var mt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},bt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function wt(t){return Array.prototype.concat.apply([],arguments)}function Et(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function It(t){return/^[\s\xa0]*$/.test(t)}var _t,Tt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function St(t,e){return-1!=t.indexOf(e)}function At(t,e){return t<e?-1:t>e?1:0}t:{var Nt=ot.navigator;if(Nt){var Dt=Nt.userAgent;if(Dt){_t=Dt;break t}}_t=""}function Ct(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function kt(t){var e={};for(var n in t)e[n]=t[n];return e}var xt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<xt.length;o++)n=xt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Ot(t){return Ot[" "](t),t}Ot[" "]=st;var Lt,Pt,Mt=St(_t,"Opera"),Ft=St(_t,"Trident")||St(_t,"MSIE"),Vt=St(_t,"Edge"),Ut=Vt||Ft,qt=St(_t,"Gecko")&&!(St(_t.toLowerCase(),"webkit")&&!St(_t,"Edge"))&&!(St(_t,"Trident")||St(_t,"MSIE"))&&!St(_t,"Edge"),jt=St(_t.toLowerCase(),"webkit")&&!St(_t,"Edge");function Bt(){var t=ot.document;return t?t.documentMode:void 0}t:{var Kt="",zt=(Pt=_t,qt?/rv:([^\);]+)(\)|;)/.exec(Pt):Vt?/Edge\/([\d\.]+)/.exec(Pt):Ft?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Pt):jt?/WebKit\/(\S+)/.exec(Pt):Mt?/(?:Version)[ \/]?(\S+)/.exec(Pt):void 0);if(zt&&(Kt=zt?zt[1]:""),Ft){var Gt=Bt();if(null!=Gt&&Gt>parseFloat(Kt)){Lt=String(Gt);break t}}Lt=Kt}var Qt,Ht={};function Wt(){return t=Ht,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=Tt(String(Lt)).split("."),n=Tt("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=At(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||At(0==o[2].length,0==s[2].length)||At(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}ot.document&&Ft?Qt=Bt()||parseInt(Lt,10)||void 0:Qt=void 0;var Yt=Qt,Xt=function(){if(!ot.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ot.addEventListener("test",st,e),ot.removeEventListener("test",st,e)}catch(t){}return t}();function $t(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Jt(t,e){if($t.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(qt){t:{try{Ot(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Zt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Jt.Z.h.call(this)}}$t.prototype.h=function(){this.defaultPrevented=!0},yt(Jt,$t);var Zt={2:"touch",3:"pen",4:"mouse"};Jt.prototype.h=function(){Jt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var te="closure_listenable_"+(1e6*Math.random()|0),ee=0;function ne(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++ee,this.ca=this.fa=!1}function re(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ie(t){this.src=t,this.g={},this.h=0}function oe(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=mt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(re(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function se(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}ie.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=se(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new ne(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var ae="closure_lm_"+(1e6*Math.random()|0),ue={};function ce(t,e,n,r,i){if(r&&r.once)return le(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)ce(t,e[o],n,r,i);return null}return n=me(n),t&&t[te]?t.N(e,n,ut(r)?!!r.capture:!!r,i):he(t,e,n,!1,r,i)}function he(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=ut(i)?!!i.capture:!!i,a=ve(t);if(a||(t[ae]=a=new ie(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=ye;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Xt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(de(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function le(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)le(t,e[o],n,r,i);return null}return n=me(n),t&&t[te]?t.O(e,n,ut(r)?!!r.capture:!!r,i):he(t,e,n,!0,r,i)}function fe(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)fe(t,e[o],n,r,i);else r=ut(r)?!!r.capture:!!r,n=me(n),t&&t[te]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=se(o=t.g[e],n,r,i))&&(re(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=ve(t))&&(e=t.g[e.toString()],t=-1,e&&(t=se(e,n,r,i)),(n=-1<t?e[t]:null)&&pe(n))}function pe(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[te])oe(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(de(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ve(e))?(oe(n,t),0==n.h&&(n.src=null,e[ae]=null)):re(t)}}}function de(t){return t in ue?ue[t]:ue[t]="on"+t}function ye(t,e){if(t.ca)t=!0;else{e=new Jt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&pe(t),t=n.call(r,e)}return t}function ve(t){return(t=t[ae])instanceof ie?t:null}var ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function me(t){return"function"==typeof t?t:(t[ge]||(t[ge]=function(e){return t.handleEvent(e)}),t[ge])}function be(){vt.call(this),this.i=new ie(this),this.P=this,this.I=null}function we(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new $t(e,t);else if(e instanceof $t)e.target=e.target||t;else{var i=e;Rt(e=new $t(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Ee(s,r,!0,e)&&i}if(i=Ee(s=e.g=t,r,!0,e)&&i,i=Ee(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Ee(s=e.g=n[o],r,!1,e)&&i}function Ee(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&oe(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}yt(be,vt),be.prototype[te]=!0,be.prototype.removeEventListener=function(t,e,n,r){fe(this,t,e,n,r)},be.prototype.M=function(){if(be.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)re(n[r]);delete e.g[t],e.h--}}this.I=null},be.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},be.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ie=ot.JSON.stringify;function _e(){var t=xe,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Te,Se=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Ae.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Ae=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())((function(){return new Ne}),(function(t){return t.reset()})),Ne=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function De(t){ot.setTimeout((function(){throw t}),0)}function Ce(t,e){Te||function(){var t=ot.Promise.resolve(void 0);Te=function(){t.then(Re)}}(),ke||(Te(),ke=!0),xe.add(t,e)}var ke=!1,xe=new Se;function Re(){for(var t;t=_e();){try{t.h.call(t.g)}catch(t){De(t)}var e=Ae;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ke=!1}function Oe(t,e){be.call(this),this.h=t||1,this.g=e||ot,this.j=pt(this.kb,this),this.l=Date.now()}function Le(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Pe(t,e,n){if("function"==typeof t)n&&(t=pt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=pt(t.handleEvent,t)}return 2147483647<Number(e)?-1:ot.setTimeout(t,e||0)}function Me(t){t.g=Pe((function(){t.g=null,t.i&&(t.i=!1,Me(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}yt(Oe,be),(nt=Oe.prototype).da=!1,nt.S=null,nt.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),we(this,"tick"),this.da&&(Le(this),this.start()))}},nt.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},nt.M=function(){Oe.Z.M.call(this),Le(this),delete this.g};var Fe=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}tt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Me(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(ot.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(vt);function Ve(t){vt.call(this),this.h=t,this.g={}}yt(Ve,vt);var Ue=[];function qe(t,e,n,r){Array.isArray(n)||(n&&(Ue[0]=n.toString()),n=Ue);for(var i=0;i<n.length;i++){var o=ce(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function je(t){Ct(t.g,(function(t,e){this.g.hasOwnProperty(e)&&pe(t)}),t),t.g={}}function Be(){this.g=!0}function Ke(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ie(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Ve.prototype.M=function(){Ve.Z.M.call(this),je(this)},Ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Be.prototype.Aa=function(){this.g=!1},Be.prototype.info=function(){};var ze={},Ge=null;function Qe(){return Ge=Ge||new be}function He(t){$t.call(this,ze.Ma,t)}function We(t){var e=Qe();we(e,new He(e,t))}function Ye(t,e){$t.call(this,ze.STAT_EVENT,t),this.stat=e}function Xe(t){var e=Qe();we(e,new Ye(e,t))}function $e(t,e){$t.call(this,ze.Na,t),this.size=e}function Je(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return ot.setTimeout((function(){t()}),e)}ze.Ma="serverreachability",yt(He,$t),ze.STAT_EVENT="statevent",yt(Ye,$t),ze.Na="timingevent",yt($e,$t);var Ze={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},tn={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function en(){}function nn(t){return t.h||(t.h=t.i())}function rn(){}en.prototype.h=null;var on,sn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function an(){$t.call(this,"d")}function un(){$t.call(this,"c")}function cn(){}function hn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Ve(this),this.P=fn,t=Ut?125:void 0,this.W=new Oe(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ln}function ln(){this.i=null,this.g="",this.h=!1}yt(an,$t),yt(un,$t),yt(cn,en),cn.prototype.g=function(){return new XMLHttpRequest},cn.prototype.i=function(){return{}},on=new cn;var fn=45e3,pn={},dn={};function yn(t,e,n){t.K=1,t.v=Vn(Rn(e)),t.s=n,t.U=!0,vn(t,null)}function vn(t,e){t.F=Date.now(),wn(t),t.A=Rn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),$n(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ln,t.g=Jr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Fe(pt(t.Ia,t,t.g),t.O)),qe(t.V,t.g,"readystatechange",t.gb),e=t.H?kt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),We(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function gn(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function mn(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=bn(t,n))==dn){4==e&&(t.o=4,Xe(14),i=!1),Ke(t.j,t.m,null,"[Incomplete Response]");break}if(r==pn){t.o=4,Xe(15),Ke(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Ke(t.j,t.m,r,null),Sn(t,r)}gn(t)&&r!=dn&&r!=pn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Xe(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),zr(e),e.L=!0,Xe(11))):(Ke(t.j,t.m,n,"[Invalid Chunked Response]"),Tn(t),_n(t))}function bn(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?dn:(n=Number(e.substring(n,r)),isNaN(n)?pn:(r+=1)+n>e.length?dn:(e=e.substr(r,n),t.C=r+n,e))}function wn(t){t.Y=Date.now()+t.P,En(t,t.P)}function En(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Je(pt(t.eb,t),e)}function In(t){t.B&&(ot.clearTimeout(t.B),t.B=null)}function _n(t){0==t.l.G||t.I||Hr(t.l,t)}function Tn(t){In(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Le(t.W),je(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Sn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ir(n.i,t)))if(n.I=t.N,!t.J&&ir(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Qr(n),Pr(n)}Kr(n),Xe(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Je(pt(n.ab,n),6e3));if(1>=rr(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Yr(n,11)}else if((t.J||n.g==t)&&Qr(n),!It(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(St(h,"spdy")||St(h,"quic")||St(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(or(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Fn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var p=t;if((r=n).oa=$r(r,r.H?r.la:null,r.W),p.J){sr(r.i,p);var d=p,y=r.K;y&&d.setTimeout(y),d.B&&(In(d),wn(d)),r.g=p}else Br(r);0<n.l.length&&Vr(n)}else"stop"!=o[0]&&"close"!=o[0]||Yr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Yr(n,7):Lr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}We(4)}catch(o){}}function An(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(at(t)||"string"==typeof t)bt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(at(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(at(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Nn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Nn)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Dn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Cn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Cn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Cn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(nt=hn.prototype).setTimeout=function(t){this.P=t},nt.gb=function(t){t=t.target;var e=this.L;e&&3==Cr(t)?e.l():this.Ia(t)},nt.Ia=function(t){try{if(t==this.g)t:{var e=Cr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||Ut||this.g&&(this.h.h||this.g.ga()||kr(this.g)))){this.I||4!=e||7==n||We(8==n||0>=r?3:2),In(this);var i=this.g.ba();this.N=i;e:if(gn(this)){var o=kr(this.g);t="";var s=o.length,a=4==Cr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Tn(this),_n(this);var u="";break e}this.h.i=new ot.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!It(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,Xe(12),Tn(this),_n(this);break t}Ke(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Sn(this,i)}this.U?(mn(this,e,u),Ut&&this.i&&3==e&&(qe(this.V,this.W,"tick",this.fb),this.W.start())):(Ke(this.j,this.m,u,null),Sn(this,u)),4==e&&Tn(this),this.i&&!this.I&&(4==e?Hr(this.l,this):(this.i=!1,wn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,Xe(12)):(this.o=0,Xe(13)),Tn(this),_n(this)}}}catch(e){}},nt.fb=function(){if(this.g){var t=Cr(this.g),e=this.g.ga();this.C<e.length&&(In(this),mn(this,t,e),this.i&&4!=t&&wn(this))}},nt.cancel=function(){this.I=!0,Tn(this)},nt.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(We(3),Xe(17)),Tn(this),this.o=2,_n(this)):En(this,this.Y-t)},(nt=Nn.prototype).R=function(){Dn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},nt.T=function(){return Dn(this),this.g.concat()},nt.get=function(t,e){return Cn(this.h,t)?this.h[t]:e},nt.set=function(t,e){Cn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},nt.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var kn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function xn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof xn){this.g=void 0!==e?e:t.g,On(this,t.j),this.s=t.s,Ln(this,t.i),Pn(this,t.m),this.l=t.l,e=t.h;var n=new Hn;n.i=e.i,e.g&&(n.g=new Nn(e.g),n.h=e.h),Mn(this,n),this.o=t.o}else t&&(n=String(t).match(kn))?(this.g=!!e,On(this,n[1]||"",!0),this.s=Un(n[2]||""),Ln(this,n[3]||"",!0),Pn(this,n[4]),this.l=Un(n[5]||"",!0),Mn(this,n[6]||"",!0),this.o=Un(n[7]||"")):(this.g=!!e,this.h=new Hn(null,this.g))}function Rn(t){return new xn(t)}function On(t,e,n){t.j=n?Un(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ln(t,e,n){t.i=n?Un(e,!0):e}function Pn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Mn(t,e,n){e instanceof Hn?(t.h=e,function(t,e){e&&!t.j&&(Wn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Yn(this,e),$n(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=qn(e,Gn)),t.h=new Hn(e,t.g))}function Fn(t,e,n){t.h.set(e,n)}function Vn(t){return Fn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,jn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function jn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}xn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(qn(e,Bn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(qn(e,Bn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(qn(n,"/"==n.charAt(0)?zn:Kn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",qn(n,Qn)),t.join("")};var Bn=/[#\/\?@]/g,Kn=/[#\?:]/g,zn=/[#\?]/g,Gn=/[#\?@]/g,Qn=/#/g;function Hn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Wn(t){t.g||(t.g=new Nn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Yn(t,e){Wn(t),e=Jn(t,e),Cn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Cn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Dn(t)))}function Xn(t,e){return Wn(t),e=Jn(t,e),Cn(t.g.h,e)}function $n(t,e,n){Yn(t,e),0<n.length&&(t.i=null,t.g.set(Jn(t,e),Et(n)),t.h+=n.length)}function Jn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(nt=Hn.prototype).add=function(t,e){Wn(this),this.i=null,t=Jn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},nt.forEach=function(t,e){Wn(this),this.g.forEach((function(n,r){bt(n,(function(n){t.call(e,n,r,this)}),this)}),this)},nt.T=function(){Wn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},nt.R=function(t){Wn(this);var e=[];if("string"==typeof t)Xn(this,t)&&(e=wt(e,this.g.get(Jn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=wt(e,t[n])}return e},nt.set=function(t,e){return Wn(this),this.i=null,Xn(this,t=Jn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},nt.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},nt.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Zn=function(t,e){this.h=t,this.g=e};function tr(t){this.l=t||er,t=ot.PerformanceNavigationTiming?0<(t=ot.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(ot.g&&ot.g.Ea&&ot.g.Ea()&&ot.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var er=10;function nr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function rr(t){return t.h?1:t.g?t.g.size:0}function ir(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function or(t,e){t.g?t.g.add(e):t.h=e}function sr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ar(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=et(t.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return Et(t.i)}function ur(){}function cr(){this.g=new ur}function hr(t,e,n){var r=n||"";try{An(t,(function(t,n){var i=t;ut(t)&&(i=Ie(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function lr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function fr(t){this.l=t.$b||null,this.j=t.ib||!1}function pr(t,e){be.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=dr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tr.prototype.cancel=function(){var t,e;if(this.i=ar(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=et(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},ur.prototype.stringify=function(t){return ot.JSON.stringify(t,void 0)},ur.prototype.parse=function(t){return ot.JSON.parse(t,void 0)},yt(fr,en),fr.prototype.g=function(){return new pr(this.l,this.j)},fr.prototype.i=function(t){return function(){return t}}({}),yt(pr,be);var dr=0;function yr(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function vr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,gr(t)}function gr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(nt=pr.prototype).open=function(t,e){if(this.readyState!=dr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,gr(this)},nt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ot).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},nt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,vr(this)),this.readyState=dr},nt.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,gr(this)),this.g&&(this.readyState=3,gr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==ot.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yr(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},nt.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?vr(this):gr(this),3==this.readyState&&yr(this)}},nt.Ua=function(t){this.g&&(this.response=this.responseText=t,vr(this))},nt.Ta=function(t){this.g&&(this.response=t,vr(this))},nt.ha=function(){this.g&&vr(this)},nt.setRequestHeader=function(t,e){this.v.append(t,e)},nt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},nt.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(pr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var mr=ot.JSON.parse;function br(t){be.call(this),this.headers=new Nn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=wr,this.K=this.L=!1}yt(br,be);var wr="",Er=/^https?$/i,Ir=["POST","PUT"];function _r(t){return"content-type"==t.toLowerCase()}function Tr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Sr(t),Nr(t)}function Sr(t){t.D||(t.D=!0,we(t,"complete"),we(t,"error"))}function Ar(t){if(t.h&&void 0!==it&&(!t.C[1]||4!=Cr(t)||2!=t.ba()))if(t.v&&4==Cr(t))Pe(t.Fa,0,t);else if(we(t,"readystatechange"),4==Cr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(kn)[1]||null;if(!o&&ot.self&&ot.self.location){var s=ot.self.location.protocol;o=s.substr(0,s.length-1)}i=!Er.test(o?o.toLowerCase():"")}e=i}if(e)we(t,"complete"),we(t,"success");else{t.m=6;try{var a=2<Cr(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Sr(t)}}finally{Nr(t)}}}function Nr(t,e){if(t.g){Dr(t);var n=t.g,r=t.C[0]?st:null;t.g=null,t.C=null,e||we(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Dr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ot.clearTimeout(t.A),t.A=null)}function Cr(t){return t.g?t.g.readyState:0}function kr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case wr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function xr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Ct(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Fn(t,e,n))}function Rr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Or(t){this.za=0,this.l=[],this.h=new Be,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Rr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Rr("baseRetryDelayMs",5e3,t),this.$a=Rr("retryDelaySeedMs",1e4,t),this.Ya=Rr("forwardChannelMaxRetries",2,t),this.ra=Rr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new tr(t&&t.concurrentRequestLimit),this.Ca=new cr,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Lr(t){if(Mr(t),3==t.G){var e=t.V++,n=Rn(t.F);Fn(n,"SID",t.J),Fn(n,"RID",e),Fn(n,"TYPE","terminate"),qr(t,n),(e=new hn(t,t.h,e,void 0)).K=2,e.v=Vn(Rn(n)),n=!1,ot.navigator&&ot.navigator.sendBeacon&&(n=ot.navigator.sendBeacon(e.v.toString(),"")),!n&&ot.Image&&((new Image).src=e.v,n=!0),n||(e.g=Jr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),wn(e)}Xr(t)}function Pr(t){t.g&&(zr(t),t.g.cancel(),t.g=null)}function Mr(t){Pr(t),t.u&&(ot.clearTimeout(t.u),t.u=null),Qr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&ot.clearTimeout(t.m),t.m=null)}function Fr(t,e){t.l.push(new Zn(t.Za++,e)),3==t.G&&Vr(t)}function Vr(t){nr(t.i)||t.m||(t.m=!0,Ce(t.Ha,t),t.C=0)}function Ur(t,e){var n;n=e?e.m:t.V++;var r=Rn(t.F);Fn(r,"SID",t.J),Fn(r,"RID",n),Fn(r,"AID",t.U),qr(t,r),t.o&&t.s&&xr(r,t.o,t.s),n=new hn(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=jr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),or(t.i,n),yn(n,r,e)}function qr(t,e){t.j&&An({},(function(t,n){Fn(e,n,t)}))}function jr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?pt(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{hr(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Br(t){t.g||t.u||(t.Y=1,Ce(t.Ga,t),t.A=0)}function Kr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Je(pt(t.Ga,t),Wr(t,t.A)),t.A++,0))}function zr(t){null!=t.B&&(ot.clearTimeout(t.B),t.B=null)}function Gr(t){t.g=new hn(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Rn(t.oa);Fn(e,"RID","rpc"),Fn(e,"SID",t.J),Fn(e,"CI",t.N?"0":"1"),Fn(e,"AID",t.U),qr(t,e),Fn(e,"TYPE","xmlhttp"),t.o&&t.s&&xr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Vn(Rn(e)),n.s=null,n.U=!0,vn(n,t)}function Qr(t){null!=t.v&&(ot.clearTimeout(t.v),t.v=null)}function Hr(t,e){var n=null;if(t.g==e){Qr(t),zr(t),t.g=null;var r=2}else{if(!ir(t.i,e))return;n=e.D,sr(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;we(r=Qe(),new $e(r,n,e,i)),Vr(t)}else Br(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(rr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Je(pt(t.Ha,t,e),Wr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Kr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Yr(t,5);break;case 4:Yr(t,10);break;case 3:Yr(t,6);break;default:Yr(t,2)}}function Wr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Yr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=pt(t.jb,t);n||(n=new xn("//www.google.com/images/cleardot.gif"),ot.location&&"http"==ot.location.protocol||On(n,"https"),Vn(n)),function(t,e){var n=new Be;if(ot.Image){var r=new Image;r.onload=dt(lr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=dt(lr,n,r,"TestLoadImage: error",!1,e),r.onabort=dt(lr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=dt(lr,n,r,"TestLoadImage: timeout",!1,e),ot.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Xe(2);t.G=0,t.j&&t.j.va(e),Xr(t),Mr(t)}function Xr(t){t.G=0,t.I=-1,t.j&&(0==ar(t.i).length&&0==t.l.length||(t.i.i.length=0,Et(t.l),t.l.length=0),t.j.ua())}function $r(t,e,n){var r=function(t){return t instanceof xn?Rn(t):new xn(t,void 0)}(n);if(""!=r.i)e&&Ln(r,e+"."+r.i),Pn(r,r.m);else{var i=ot.location;r=function(t,e,n,r){var i=new xn(null,void 0);return t&&On(i,t),e&&Ln(i,e),n&&Pn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Ct(t.aa,(function(t,e){Fn(r,e,t)})),e=t.D,n=t.sa,e&&n&&Fn(r,e,n),Fn(r,"VER",t.ma),qr(t,r),r}function Jr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new br(new fr({ib:!0})):new br(t.qa)).L=t.H,e}function Zr(){}function ti(){if(Ft&&!(10<=Number(Yt)))throw Error("Environmental error: no available transport.")}function ei(t,e){be.call(this),this.g=new Or(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!It(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!It(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ii(this)}function ni(t){an.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ri(){un.call(this),this.status=1}function ii(t){this.g=t}(nt=br.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():on.g(),this.C=this.u?nn(this.u):nn(on),this.g.onreadystatechange=pt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Tr(this,t)}t=n||"";var i=new Nn(this.headers);r&&An(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=_r,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=ot.FormData&&t instanceof ot.FormData,!(0<=mt(Ir,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Dr(this),0<this.B&&((this.K=function(t){return Ft&&Wt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pt(this.pa,this)):this.A=Pe(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Tr(this,t)}},nt.pa=function(){void 0!==it&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,we(this,"timeout"),this.abort(8))},nt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,we(this,"complete"),we(this,"abort"),Nr(this))},nt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nr(this,!0)),br.Z.M.call(this)},nt.Fa=function(){this.s||(this.F||this.v||this.l?Ar(this):this.cb())},nt.cb=function(){Ar(this)},nt.ba=function(){try{return 2<Cr(this)?this.g.status:-1}catch(t){return-1}},nt.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},nt.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),mr(e)}},nt.Da=function(){return this.m},nt.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(nt=Or.prototype).ma=8,nt.G=1,nt.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},nt.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new hn(this,this.h,t,void 0),n=this.s;if(this.P&&(n?Rt(n=kt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=jr(this,e,r),Fn(i=Rn(this.F),"RID",t),Fn(i,"CVER",22),this.D&&Fn(i,"X-HTTP-Session-Id",this.D),qr(this,i),this.o&&n&&xr(i,this.o,n),or(this.i,e),this.Ra&&Fn(i,"TYPE","init"),this.ja?(Fn(i,"$req",r),Fn(i,"SID","null"),e.$=!0,yn(e,i,null)):yn(e,i,r),this.G=2}}else 3==this.G&&(t?Ur(this,t):0==this.l.length||nr(this.i)||Ur(this))},nt.Ga=function(){if(this.u=null,Gr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Je(pt(this.bb,this),t)}},nt.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Xe(10),Pr(this),Gr(this))},nt.ab=function(){null!=this.v&&(this.v=null,Pr(this),Kr(this),Xe(19))},nt.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Xe(2)):(this.h.info("Failed to ping google.com"),Xe(1))},(nt=Zr.prototype).xa=function(){},nt.wa=function(){},nt.va=function(){},nt.ua=function(){},nt.Oa=function(){},ti.prototype.g=function(t,e){return new ei(t,e)},yt(ei,be),ei.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Ce(pt(t.hb,t,e))),Xe(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=$r(t,null,t.W),Vr(t)},ei.prototype.close=function(){Lr(this.g)},ei.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Fr(this.g,e)}else this.v?((e={}).__data__=Ie(t),Fr(this.g,e)):Fr(this.g,t)},ei.prototype.M=function(){this.g.j=null,delete this.j,Lr(this.g),delete this.g,ei.Z.M.call(this)},yt(ni,an),yt(ri,un),yt(ii,Zr),ii.prototype.xa=function(){we(this.g,"a")},ii.prototype.wa=function(t){we(this.g,new ni(t))},ii.prototype.va=function(t){we(this.g,new ri(t))},ii.prototype.ua=function(){we(this.g,"b")},ti.prototype.createWebChannel=ti.prototype.g,ei.prototype.send=ei.prototype.u,ei.prototype.open=ei.prototype.m,ei.prototype.close=ei.prototype.close,Ze.NO_ERROR=0,Ze.TIMEOUT=8,Ze.HTTP_ERROR=6,tn.COMPLETE="complete",rn.EventType=sn,sn.OPEN="a",sn.CLOSE="b",sn.ERROR="c",sn.MESSAGE="d",be.prototype.listen=be.prototype.N,br.prototype.listenOnce=br.prototype.O,br.prototype.getLastError=br.prototype.La,br.prototype.getLastErrorCode=br.prototype.Da,br.prototype.getStatus=br.prototype.ba,br.prototype.getResponseJson=br.prototype.Qa,br.prototype.getResponseText=br.prototype.ga,br.prototype.send=br.prototype.ea;var oi=Ze,si=tn,ai=ze,ui=10,ci=11,hi=fr,li=rn,fi=br,pi=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();pi.o=-1;var di={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},yi=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return n(e,t),e}(Error),vi=new F("@firebase/firestore");function gi(){return vi.logLevel}function mi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(vi.logLevel<=k.DEBUG){var r=e.map(Ei);vi.debug.apply(vi,u(["Firestore (8.10.1): "+t],r))}}function bi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(vi.logLevel<=k.ERROR){var r=e.map(Ei);vi.error.apply(vi,u(["Firestore (8.10.1): "+t],r))}}function wi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(vi.logLevel<=k.WARN){var r=e.map(Ei);vi.warn.apply(vi,u(["Firestore (8.10.1): "+t],r))}}function Ei(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Ii(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw bi(e),new Error(e)}function _i(t,e){t||Ii()}function Ti(t,e){return t}function Si(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ai=function(){function t(){}return t.u=function(){for(var t=62*Math.floor(256/62),e="";e.length<20;)for(var n=Si(40),r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62));return e},t}();function Ni(t,e){return t<e?-1:t>e?1:0}function Di(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Ci(t){return t+"\0"}var ki=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new yi(di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new yi(di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new yi(di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new yi(di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Ni(this.nanoseconds,t.nanoseconds):Ni(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),xi=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ki(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Ri(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Oi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Li(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Pi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Ii(),void 0===n?n=t.length-e:n>t.length-e&&Ii(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Mi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new yi(di.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Pi),Fi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Vi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Fi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new yi(di.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new yi(di.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new yi(di.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new yi(di.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Pi),Ui=function(){function t(t){this.fields=t,t.sort(Vi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Di(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),qi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Ni(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();qi.EMPTY_BYTE_STRING=new qi("");var ji=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bi(t){if(_i(!!t),"string"==typeof t){var e=0,n=ji.exec(t);if(_i(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ki(t.seconds),nanos:Ki(t.nanos)}}function Ki(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function zi(t){return"string"==typeof t?qi.fromBase64String(t):qi.fromUint8Array(t)}function Gi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Qi(t){var e=t.mapValue.fields.__previous_value__;return Gi(e)?Qi(e):e}function Hi(t){var e=Bi(t.mapValue.fields.__local_write_time__.timestampValue);return new ki(e.seconds,e.nanos)}function Wi(t){return null==t}function Yi(t){return 0===t&&1/t==-1/0}function Xi(t){return"number"==typeof t&&Number.isInteger(t)&&!Yi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var $i=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Mi.fromString(e))},t.fromName=function(e){return new t(Mi.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Mi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Mi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Mi(e.slice()))},t}();function Ji(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Gi(t)?4:10:Ii()}function Zi(t,e){var n=Ji(t);if(n!==Ji(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Hi(t).isEqual(Hi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Bi(t.timestampValue),r=Bi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return zi(t.bytesValue).isEqual(zi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ki(t.geoPointValue.latitude)===Ki(e.geoPointValue.latitude)&&Ki(t.geoPointValue.longitude)===Ki(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ki(t.integerValue)===Ki(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ki(t.doubleValue),r=Ki(e.doubleValue);return n===r?Yi(n)===Yi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Di(t.arrayValue.values||[],e.arrayValue.values||[],Zi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ri(n)!==Ri(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Zi(n[i],r[i])))return!1;return!0}(t,e);default:return Ii()}}function to(t,e){return void 0!==(t.values||[]).find((function(t){return Zi(t,e)}))}function eo(t,e){var n=Ji(t),r=Ji(e);if(n!==r)return Ni(n,r);switch(n){case 0:return 0;case 1:return Ni(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ki(t.integerValue||t.doubleValue),r=Ki(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return no(t.timestampValue,e.timestampValue);case 4:return no(Hi(t),Hi(e));case 5:return Ni(t.stringValue,e.stringValue);case 6:return function(t,e){var n=zi(t),r=zi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ni(n[i],r[i]);if(0!==o)return o}return Ni(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Ni(Ki(t.latitude),Ki(e.latitude));return 0!==n?n:Ni(Ki(t.longitude),Ki(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=eo(n[i],r[i]);if(o)return o}return Ni(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Ni(r[s],o[s]);if(0!==a)return a;var u=eo(n[r[s]],i[o[s]]);if(0!==u)return u}return Ni(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Ii()}}function no(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ni(t,e);var n=Bi(t),r=Bi(e),i=Ni(n.seconds,r.seconds);return 0!==i?i:Ni(n.nanos,r.nanos)}function ro(t){return io(t)}function io(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Bi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?zi(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,$i.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=io(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+io(t.fields[o])}return e+"}"}(t.mapValue):Ii();var e,n}function oo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function so(t){return!!t&&"integerValue"in t}function ao(t){return!!t&&"arrayValue"in t}function uo(t){return!!t&&"nullValue"in t}function co(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ho(t){return!!t&&"mapValue"in t}function lo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Oi(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=lo(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=lo(t.arrayValue.values[r]);return n}return Object.assign({},t)}var fo=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!ho(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=lo(e)},t.prototype.setAll=function(t){var e=this,n=Vi.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=lo(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());ho(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Zi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];ho(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Oi(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(lo(this.value))},t}();function po(t){var e=[];return Oi(t.fields,(function(t,n){var r=new Vi([t]);if(ho(n)){var i=po(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Ui(e)}var yo=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,xi.min(),fo.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,fo.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,fo.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=fo.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=fo.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),vo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function go(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new vo(t,e,n,r,i,o,s)}function mo(t){var e=Ti(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+ro(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),Wi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=xo(e.startAt)),e.endAt&&(n+="|ub:",n+=xo(e.endAt)),e.h=n}return e.h}function bo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Oo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Zi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Po(t.startAt,e.startAt)&&Po(t.endAt,e.endAt)}function wo(t){return $i.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Eo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return n(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Io(t,n,r):"array-contains"===n?new Ao(t,r):"in"===n?new No(t,r):"not-in"===n?new Do(t,r):"array-contains-any"===n?new Co(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new _o(t,n):new To(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(eo(e,this.value)):null!==e&&Ji(this.value)===Ji(e)&&this.m(eo(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ii()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Io=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=$i.fromName(r.referenceValue),i}return n(e,t),e.prototype.matches=function(t){var e=$i.comparator(t.key,this.key);return this.m(e)},e}(Eo),_o=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=So(0,n),r}return n(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Eo),To=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=So(0,n),r}return n(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Eo);function So(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return $i.fromName(t.referenceValue)}))}var Ao=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return n(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return ao(e)&&to(e.arrayValue,this.value)},e}(Eo),No=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return n(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&to(this.value.arrayValue,e)},e}(Eo),Do=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return n(e,t),e.prototype.matches=function(t){if(to(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!to(this.value.arrayValue,e)},e}(Eo),Co=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return n(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!ao(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return to(e.value.arrayValue,t)}))},e}(Eo),ko=function(t,e){this.position=t,this.before=e};function xo(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ro(t)})).join(",")}var Ro=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Oo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Lo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?$i.comparator($i.fromName(s.referenceValue),n.key):eo(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Po(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Zi(t.position[n],e.position[n]))return!1;return!0}var Mo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Fo(t,e,n,r,i,o,s,a){return new Mo(t,e,n,r,i,o,s,a)}function Vo(t){return new Mo(t)}function Uo(t){return!Wi(t.limit)&&"F"===t.limitType}function qo(t){return!Wi(t.limit)&&"L"===t.limitType}function jo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Bo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ko(t){return null!==t.collectionGroup}function zo(t){var e=Ti(t);if(null===e.p){e.p=[];var n=Bo(e),r=jo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Ro(n)),e.p.push(new Ro(Vi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Ro(Vi.keyField(),u))}}}return e.p}function Go(t){var e=Ti(t);if(!e.T)if("F"===e.limitType)e.T=go(e.path,e.collectionGroup,zo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=zo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ro(o.field,s))}var a=e.endAt?new ko(e.endAt.position,!e.endAt.before):null,u=e.startAt?new ko(e.startAt.position,!e.startAt.before):null;e.T=go(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Qo(t,e,n){return new Mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ho(t,e){return bo(Go(t),Go(e))&&t.limitType===e.limitType}function Wo(t){return mo(Go(t))+"|lt:"+t.limitType}function Yo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+ro(e.value);var e})).join(", ")+"]"),Wi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+xo(t.startAt)),t.endAt&&(e+=", endAt: "+xo(t.endAt)),"Target("+e+")"}(Go(t))+"; limitType="+t.limitType+")"}function Xo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):$i.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Lo(t.startAt,zo(t),e)||t.endAt&&Lo(t.endAt,zo(t),e))}(t,e)}function $o(t){return function(e,n){for(var r=!1,i=0,o=zo(t);i<o.length;i++){var s=o[i],a=Jo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Jo(t,e,n){var r=t.field.isKeyField()?$i.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?eo(r,i):Ii()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ii()}}function Zo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yi(e)?"-0":e}}function ts(t){return{integerValue:""+t}}function es(t,e){return Xi(e)?ts(e):Zo(t,e)}var ns=function(){this._=void 0};function rs(t,e,n){return t instanceof ss?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof as?us(t,e):t instanceof cs?hs(t,e):function(t,e){var n=os(t,e),r=fs(n)+fs(t.A);return so(n)&&so(t.A)?ts(r):Zo(t.R,r)}(t,e)}function is(t,e,n){return t instanceof as?us(t,e):t instanceof cs?hs(t,e):n}function os(t,e){return t instanceof ls?so(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var ss=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(ns),as=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return n(e,t),e}(ns);function us(t,e){for(var n=ps(e),r=function(t){n.some((function(e){return Zi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var cs=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return n(e,t),e}(ns);function hs(t,e){for(var n=ps(e),r=function(t){n=n.filter((function(e){return!Zi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ls=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return n(e,t),e}(ns);function fs(t){return Ki(t.integerValue||t.doubleValue)}function ps(t){return ao(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ds=function(t,e){this.field=t,this.transform=e},ys=function(t,e){this.version=t,this.transformResults=e},vs=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function gs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var ms=function(){};function bs(t,e,n){t instanceof Ts?function(t,e,n){var r=t.value.clone(),i=Ns(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ss?function(t,e,n){if(gs(t.precondition,e)){var r=Ns(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(As(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ws(t,e,n){t instanceof Ts?function(t,e,n){if(gs(t.precondition,e)){var r=t.value.clone(),i=Ds(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(_s(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Ss?function(t,e,n){if(gs(t.precondition,e)){var r=Ds(t.fieldTransforms,n,e),i=e.data;i.setAll(As(t)),i.setAll(r),e.convertToFoundDocument(_s(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){gs(t.precondition,e)&&e.convertToNoDocument(xi.min())}(t,e)}function Es(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=os(o.transform,s||null);null!=a&&(null==n&&(n=fo.empty()),n.set(o.field,a))}return n||null}function Is(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Di(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof as&&e instanceof as||t instanceof cs&&e instanceof cs?Di(t.elements,e.elements,Zi):t instanceof ls&&e instanceof ls?Zi(t.A,e.A):t instanceof ss&&e instanceof ss}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function _s(t){return t.isFoundDocument()?t.version:xi.min()}var Ts=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return n(e,t),e}(ms),Ss=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return n(e,t),e}(ms);function As(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Ns(t,e,n){var r=new Map;_i(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,is(s,a,n[i]))}return r}function Ds(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,rs(a,u,e))}return r}var Cs,ks,xs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return n(e,t),e}(ms),Rs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return n(e,t),e}(ms),Os=function(t){this.count=t};function Ls(t){switch(t){case di.OK:return Ii();case di.CANCELLED:case di.UNKNOWN:case di.DEADLINE_EXCEEDED:case di.RESOURCE_EXHAUSTED:case di.INTERNAL:case di.UNAVAILABLE:case di.UNAUTHENTICATED:return!1;case di.INVALID_ARGUMENT:case di.NOT_FOUND:case di.ALREADY_EXISTS:case di.PERMISSION_DENIED:case di.FAILED_PRECONDITION:case di.ABORTED:case di.OUT_OF_RANGE:case di.UNIMPLEMENTED:case di.DATA_LOSS:return!0;default:return Ii()}}function Ps(t){if(void 0===t)return bi("GRPC error has no .code"),di.UNKNOWN;switch(t){case Cs.OK:return di.OK;case Cs.CANCELLED:return di.CANCELLED;case Cs.UNKNOWN:return di.UNKNOWN;case Cs.DEADLINE_EXCEEDED:return di.DEADLINE_EXCEEDED;case Cs.RESOURCE_EXHAUSTED:return di.RESOURCE_EXHAUSTED;case Cs.INTERNAL:return di.INTERNAL;case Cs.UNAVAILABLE:return di.UNAVAILABLE;case Cs.UNAUTHENTICATED:return di.UNAUTHENTICATED;case Cs.INVALID_ARGUMENT:return di.INVALID_ARGUMENT;case Cs.NOT_FOUND:return di.NOT_FOUND;case Cs.ALREADY_EXISTS:return di.ALREADY_EXISTS;case Cs.PERMISSION_DENIED:return di.PERMISSION_DENIED;case Cs.FAILED_PRECONDITION:return di.FAILED_PRECONDITION;case Cs.ABORTED:return di.ABORTED;case Cs.OUT_OF_RANGE:return di.OUT_OF_RANGE;case Cs.UNIMPLEMENTED:return di.UNIMPLEMENTED;case Cs.DATA_LOSS:return di.DATA_LOSS;default:return Ii()}}(ks=Cs||(Cs={}))[ks.OK=0]="OK",ks[ks.CANCELLED=1]="CANCELLED",ks[ks.UNKNOWN=2]="UNKNOWN",ks[ks.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ks[ks.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ks[ks.NOT_FOUND=5]="NOT_FOUND",ks[ks.ALREADY_EXISTS=6]="ALREADY_EXISTS",ks[ks.PERMISSION_DENIED=7]="PERMISSION_DENIED",ks[ks.UNAUTHENTICATED=16]="UNAUTHENTICATED",ks[ks.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ks[ks.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ks[ks.ABORTED=10]="ABORTED",ks[ks.OUT_OF_RANGE=11]="OUT_OF_RANGE",ks[ks.UNIMPLEMENTED=12]="UNIMPLEMENTED",ks[ks.INTERNAL=13]="INTERNAL",ks[ks.UNAVAILABLE=14]="UNAVAILABLE",ks[ks.DATA_LOSS=15]="DATA_LOSS";var Ms=function(){function t(t,e){this.comparator=t,this.root=e||Vs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Vs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Fs(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Fs(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Fs(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Fs(this.root,t,this.comparator,!0)},t}(),Fs=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Vs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Ii();if(this.right.isRed())throw Ii();var t=this.left.check();if(t!==this.right.check())throw Ii();return t+(this.isRed()?0:1)},t}();Vs.EMPTY=null,Vs.RED=!0,Vs.BLACK=!1,Vs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Ii()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Ii()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Ii()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Ii()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Ii()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Vs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Us=function(){function t(t){this.comparator=t,this.data=new Ms(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new qs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new qs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),qs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),js=new Ms($i.comparator);function Bs(){return js}var Ks=new Ms($i.comparator);function zs(){return Ks}var Gs=new Ms($i.comparator);function Qs(){return Gs}var Hs=new Us($i.comparator);function Ws(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Hs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ys=new Us(Ni);function Xs(){return Ys}var $s=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Js.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(xi.min(),r,Xs(),Bs(),Ws())},t}(),Js=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(qi.EMPTY_BYTE_STRING,n,Ws(),Ws(),Ws())},t}(),Zs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ta=function(t,e){this.targetId=t,this.V=e},ea=function(t,e,n,r){void 0===n&&(n=qi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},na=function(){function t(){this.S=0,this.D=oa(),this.C=qi.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=Ws(),e=Ws(),n=Ws();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ii()}})),new Js(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=oa()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),ra=function(){function t(t){this.W=t,this.G=new Map,this.H=Bs(),this.J=ia(),this.Y=new Us(Ni)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Ii()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(wo(i))if(0===n){var o=new $i(i.path);this.tt(e,o,yo.newNoDocument(o,xi.min()))}else _i(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&wo(o.target)){var s=new $i(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,yo.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=Ws();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new $s(t,n,this.Y,this.H,r);return this.H=Bs(),this.J=ia(),this.Y=new Us(Ni),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new na,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Us(Ni),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||mi("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new na),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ia(){return new Ms($i.comparator)}function oa(){return new Ms($i.comparator)}var sa={asc:"ASCENDING",desc:"DESCENDING"},aa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ua=function(t,e){this.databaseId=t,this.I=e};function ca(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ha(t,e){return t.I?e.toBase64():e.toUint8Array()}function la(t,e){return ca(t,e.toTimestamp())}function fa(t){return _i(!!t),xi.fromTimestamp(function(t){var e=Bi(t);return new ki(e.seconds,e.nanos)}(t))}function pa(t,e){return function(t){return new Mi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function da(t){var e=Mi.fromString(t);return _i(Va(e)),e}function ya(t,e){return pa(t.databaseId,e.path)}function va(t,e){var n=da(e);if(n.get(1)!==t.databaseId.projectId)throw new yi(di.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new yi(di.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new $i(wa(n))}function ga(t,e){return pa(t.databaseId,e)}function ma(t){var e=da(t);return 4===e.length?Mi.emptyPath():wa(e)}function ba(t){return new Mi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function wa(t){return _i(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ea(t,e,n){return{name:ya(t,e),fields:n.value.mapValue.fields}}function Ia(t,e,n){var r=va(t,e.name),i=fa(e.updateTime),o=new fo({mapValue:{fields:e.fields}}),s=yo.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function _a(t,e){var n;if(e instanceof Ts)n={update:Ea(t,e.key,e.value)};else if(e instanceof xs)n={delete:ya(t,e.key)};else if(e instanceof Ss)n={update:Ea(t,e.key,e.data),updateMask:Fa(e.fieldMask)};else{if(!(e instanceof Rs))return Ii();n={verify:ya(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof ss)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof as)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof cs)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ls)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Ii()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:la(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ii()}(t,e.precondition)),n}function Ta(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?vs.updateTime(fa(t.updateTime)):void 0!==t.exists?vs.exists(t.exists):vs.none()}(e.currentDocument):vs.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)_i("REQUEST_TIME"===e.setToServerValue),n=new ss;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new as(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new cs(i)}else"increment"in e?n=new ls(t,e.increment):Ii();var o=Vi.fromServerFormat(e.fieldPath);return new ds(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=va(t,e.update.name),o=new fo({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new Ui(e.map((function(t){return Vi.fromServerFormat(t)})))}(e.updateMask);return new Ss(i,o,s,n,r)}return new Ts(i,o,n,r)}if(e.delete){var a=va(t,e.delete);return new xs(a,n)}if(e.verify){var u=va(t,e.verify);return new Rs(u,n)}return Ii()}function Sa(t,e){return{documents:[ga(t,e.path)]}}function Aa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ga(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ga(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(co(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NAN"}};if(uo(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(co(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NOT_NAN"}};if(uo(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oa(t.field),op:Ra(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Oa(t.field),direction:xa(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Wi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ca(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ca(e.endAt)),n}function Na(t){var e=ma(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){_i(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Da(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Ro(La(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return Wi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ka(n.startAt));var h=null;return n.endAt&&(h=ka(n.endAt)),Fo(e,i,a,s,u,"F",c,h)}function Da(t){return t?void 0!==t.unaryFilter?[Ma(t)]:void 0!==t.fieldFilter?[Pa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Da(t)})).reduce((function(t,e){return t.concat(e)})):Ii():[]}function Ca(t){return{before:t.before,values:t.position}}function ka(t){var e=!!t.before,n=t.values||[];return new ko(n,e)}function xa(t){return sa[t]}function Ra(t){return aa[t]}function Oa(t){return{fieldPath:t.canonicalString()}}function La(t){return Vi.fromServerFormat(t.fieldPath)}function Pa(t){return Eo.create(La(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ii()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ma(t){switch(t.unaryFilter.op){case"IS_NAN":var e=La(t.unaryFilter.field);return Eo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=La(t.unaryFilter.field);return Eo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=La(t.unaryFilter.field);return Eo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=La(t.unaryFilter.field);return Eo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ii()}}function Fa(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Va(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ua(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ja(e)),e=qa(t.get(n),e);return ja(e)}function qa(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function ja(t){return t+""}function Ba(t){var e=t.length;if(_i(e>=2),2===e)return _i(""===t.charAt(0)&&""===t.charAt(1)),Mi.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Ii(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Ii()}o=s+2}return new Mi(r)}var Ka=function(t,e){this.seconds=t,this.nanoseconds=e},za=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};za.store="owner",za.key="owner";var Ga=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ga.store="mutationQueues",Ga.keyPath="userId";var Qa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Qa.store="mutations",Qa.keyPath="batchId",Qa.userMutationsIndex="userMutationsIndex",Qa.userMutationsKeyPath=["userId","batchId"];var Ha=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ua(e)]},t.key=function(t,e,n){return[t,Ua(e),n]},t}();Ha.store="documentMutations",Ha.PLACEHOLDER=new Ha;var Wa=function(t,e){this.path=t,this.readTime=e},Ya=function(t,e){this.path=t,this.version=e},Xa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Xa.store="remoteDocuments",Xa.readTimeIndex="readTimeIndex",Xa.readTimeIndexPath="readTime",Xa.collectionReadTimeIndex="collectionReadTimeIndex",Xa.collectionReadTimeIndexPath=["parentPath","readTime"];var $a=function(t){this.byteSize=t};$a.store="remoteDocumentGlobal",$a.key="remoteDocumentGlobalKey";var Ja=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ja.store="targets",Ja.keyPath="targetId",Ja.queryTargetsIndexName="queryTargetsIndex",Ja.queryTargetsKeyPath=["canonicalId","targetId"];var Za=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Za.store="targetDocuments",Za.keyPath=["targetId","path"],Za.documentTargetsIndex="documentTargetsIndex",Za.documentTargetsKeyPath=["path","targetId"];var tu=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};tu.key="targetGlobalKey",tu.store="targetGlobal";var eu=function(t,e){this.collectionId=t,this.parent=e};eu.store="collectionParents",eu.keyPath=["collectionId","parent"];var nu=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};nu.store="clientMetadata",nu.keyPath="clientId";var ru=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ru.store="bundles",ru.keyPath="bundleId";var iu=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};iu.store="namedQueries",iu.keyPath="name";var ou=u(u([],u(u([],u(u([],u(u([],[Ga.store,Qa.store,Ha.store,Xa.store,Ja.store,za.store,tu.store,Za.store]),[nu.store])),[$a.store])),[eu.store])),[ru.store,iu.store]),su="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",au=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),uu=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},cu=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Ii(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),hu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new uu,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new pu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=mu(e.target.error);n.ft.reject(new pu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new pu(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(mi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new yu(e)},t}(),lu=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(d())&&bi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return mi("SimpleDb","Removing database:",t),vu(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=d(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return i(this,void 0,void 0,(function(){var e,n=this;return o(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(mi("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new pu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new yi(di.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new pu(t,n))},i.onupgradeneeded=function(t){mi("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){mi("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return i(this,void 0,void 0,(function(){var i,s,a,u,c;return o(this,(function(h){switch(h.label){case 0:i="readonly"===e,s=0,a=function(){var e,a,c,h,l;return o(this,(function(o){switch(o.label){case 0:++s,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=o.sent(),e=hu.open(u.db,t,i?"readonly":"readwrite",n),a=r(e).catch((function(t){return e.abort(t),cu.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(o.sent(),a),c)];case 4:return h=o.sent(),l="FirebaseError"!==h.name&&s<3,mi("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),fu=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return vu(this.Pt.delete())},t}(),pu=function(t){function e(e,n){var r=this;return(r=t.call(this,di.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return n(e,t),e}(yi);function du(t){return"IndexedDbTransactionError"===t.name}var yu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(mi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(mi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),vu(n)},t.prototype.add=function(t){return mi("SimpleDb","ADD",this.store.name,t,t),vu(this.store.add(t))},t.prototype.get=function(t){var e=this;return vu(this.store.get(t)).next((function(n){return void 0===n&&(n=null),mi("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return mi("SimpleDb","DELETE",this.store.name,t),vu(this.store.delete(t))},t.prototype.count=function(){return mi("SimpleDb","COUNT",this.store.name),vu(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){mi("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new cu((function(n,r){e.onerror=function(t){var e=mu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new cu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new fu(i),s=e(i.primaryKey,i.value,o);if(s instanceof cu){var a=s.catch((function(t){return o.done(),cu.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return cu.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function vu(t){return new cu((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=mu(t.target.error);n(e)}}))}var gu=!1;function mu(t){var e=lu._t(d());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new yi("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return gu||(gu=!0,setTimeout((function(){throw r}),0)),r}}return t}var bu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return n(e,t),e}(au);function wu(t,e){var n=Ti(t);return lu.It(n.Mt,e)}var Eu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&bs(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&ws(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&ws(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(xi.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ws())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Di(this.mutations,t.mutations,(function(t,e){return Is(t,e)}))&&Di(this.baseMutations,t.baseMutations,(function(t,e){return Is(t,e)}))},t}(),Iu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){_i(e.mutations.length===r.length);for(var i=Qs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),_u=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=xi.min()),void 0===o&&(o=xi.min()),void 0===s&&(s=qi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Tu=function(t){this.Lt=t};function Su(t,e){if(e.document)return Ia(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=$i.fromSegments(e.noDocument.path),r=ku(e.noDocument.readTime),i=yo.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=$i.fromSegments(e.unknownDocument.path);return r=ku(e.unknownDocument.version),yo.newUnknownDocument(o,r)}return Ii()}function Au(t,e,n){var r=Nu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ya(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ca(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Xa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Cu(e.version);return s=e.hasCommittedMutations,new Xa(null,new Wa(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Cu(e.version);return new Xa(new Ya(c,h),null,null,!0,r,i)}return Ii()}function Nu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Du(t){var e=new ki(t[0],t[1]);return xi.fromTimestamp(e)}function Cu(t){var e=t.toTimestamp();return new Ka(e.seconds,e.nanoseconds)}function ku(t){var e=new ki(t.seconds,t.nanoseconds);return xi.fromTimestamp(e)}function xu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ta(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Ta(t.Lt,e)})),a=ki.fromMillis(e.localWriteTimeMs);return new Eu(e.batchId,a,n,s)}function Ru(t){var e,n,r=ku(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ku(t.lastLimboFreeSnapshotVersion):xi.min();return void 0!==t.query.documents?(_i(1===(n=t.query).documents.length),e=Go(Vo(ma(n.documents[0])))):e=function(t){return Go(Na(t))}(t.query),new _u(e,t.targetId,0,t.lastListenSequenceNumber,r,i,qi.fromBase64String(t.resumeToken))}function Ou(t,e){var n,r=Cu(e.snapshotVersion),i=Cu(e.lastLimboFreeSnapshotVersion);n=wo(e.target)?Sa(t.Lt,e.target):Aa(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ja(e.targetId,mo(e.target),r,o,e.sequenceNumber,i,n)}function Lu(t){var e=Na({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Qo(e,e.limit,"L"):e}var Pu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Mu(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:ku(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Mu(t).put({bundleId:(n=e).id,createTime:Cu(fa(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Fu(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Lu(e.bundledQuery),readTime:ku(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Fu(t).put(function(t){return{name:t.name,readTime:Cu(fa(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Mu(t){return wu(t,ru.store)}function Fu(t){return wu(t,iu.store)}var Vu=function(){function t(){this.Bt=new Uu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),cu.resolve()},t.prototype.getCollectionParents=function(t,e){return cu.resolve(this.Bt.getEntries(e))},t}(),Uu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Us(Mi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Us(Mi.comparator)).toArray()},t}(),qu=function(){function t(){this.qt=new Uu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Ua(i)};return ju(t).put(o)}return cu.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ci(e),""],!1,!0);return ju(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ba(o.parent))}return n}))},t}();function ju(t){return wu(t,eu.store)}var Bu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ku=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function zu(t,e,n){var r=t.store(Qa.store),i=t.store(Ha.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){_i(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Ha.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return cu.waitFor(o).next((function(){return c}))}function Gu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ii();e=t.noDocument}return JSON.stringify(e).length}Ku.DEFAULT_COLLECTION_PERCENTILE=10,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ku.DEFAULT=new Ku(41943040,Ku.DEFAULT_COLLECTION_PERCENTILE,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ku.DISABLED=new Ku(-1,0,0);var Qu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return _i(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Wu(t).$t({index:Qa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Yu(t),s=Wu(t);return s.add({}).next((function(a){_i("number"==typeof a);for(var u=new Eu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return _a(t.Lt,e)})),i=n.mutations.map((function(e){return _a(t.Lt,e)}));return new Qa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Us((function(t,e){return Ni(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],y=Ha.key(i.userId,d.key.path,a);l=l.add(d.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Ha.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),cu.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Wu(t).get(e).next((function(t){return t?(_i(t.userId===n.userId),xu(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?cu.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Wu(t).$t({index:Qa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(_i(e.batchId>=r),o=xu(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Wu(t).$t({index:Qa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Wu(t).Nt(Qa.userMutationsIndex,n).next((function(t){return t.map((function(t){return xu(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ha.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Yu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Ba(u);if(a===n.userId&&e.path.isEqual(h))return Wu(t).get(c).next((function(t){if(!t)throw Ii();_i(t.userId===n.userId),o.push(xu(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Us(Ni),i=[];return e.forEach((function(e){var o=Ha.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Yu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Ba(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),cu.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ha.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Us(Ni);return Yu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Ba(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Wu(t).get(e).next((function(t){if(null===t)throw Ii();_i(t.userId===n.userId),r.push(xu(n.R,t))})))})),cu.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return zu(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),cu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return cu.resolve();var r=IDBKeyRange.lowerBound(Ha.prefixForUser(e.userId)),i=[];return Yu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ba(t[1]);i.push(o)}else r.done()})).next((function(){_i(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Hu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Xu(t).get(this.userId).next((function(t){return t||new Ga(e.userId,-1,"")}))},t}();function Hu(t,e,n){var r=Ha.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Yu(t).$t({range:o,Ft:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Wu(t){return wu(t,Qa.store)}function Yu(t){return wu(t,Ha.store)}function Xu(t){return wu(t,Ga.store)}var $u=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Ju=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new $u(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return xi.fromTimestamp(new ki(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Zu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return _i(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Zu(t).$t((function(s,a){var u=Ru(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return cu.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return Zu(t).$t((function(t,n){var r=Ru(n);e(r)}))},t.prototype.Xt=function(t){return tc(t).get(tu.key).next((function(t){return _i(null!==t),t}))},t.prototype.Zt=function(t,e){return tc(t).put(tu.key,e)},t.prototype.te=function(t,e){return Zu(t).put(Ou(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=mo(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Zu(t).$t({range:r,index:Ja.queryTargetsIndexName},(function(t,n,r){var o=Ru(n);bo(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ec(t);return e.forEach((function(e){var s=Ua(e.path);i.push(o.put(new Za(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),cu.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ec(t);return cu.forEach(e,(function(e){var o=Ua(e.path);return cu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ec(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ec(t),i=Ws();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=Ba(t[1]),o=new $i(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Ua(e.path),r=IDBKeyRange.bound([n],[Ci(n)],!1,!0),i=0;return ec(t).$t({index:Za.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return Zu(t).get(e).next((function(t){return t?Ru(t):null}))},t}();function Zu(t){return wu(t,Ja.store)}function tc(t){return wu(t,tu.store)}function ec(t){return wu(t,Za.store)}function nc(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){if(t.code!==di.FAILED_PRECONDITION||t.message!==su)throw t;return mi("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function rc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ni(n,i);return 0===s?Ni(r,o):s}var ic=function(){function t(t){this.ne=t,this.buffer=new Us(rc),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();rc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),oc=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;mi("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return i(e,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return du(e=n.sent())?(mi("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,nc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),sc=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return cu.resolve(pi.o);var r=new ic(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(mi("LruGarbageCollector","Garbage collection skipped; disabled"),cu.resolve(Bu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(mi("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Bu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(mi("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),gi()<=k.DEBUG&&mi("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),cu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),ac=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new sc(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return uc(t,n)},t.prototype.removeReference=function(t,e,n){return uc(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return uc(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Xu(t).Ot((function(r){return Hu(t,r,e).next((function(t){return t&&(n=!0),cu.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),ec(t).delete([0,Ua(s.path)])}))}));i.push(u)}})).next((function(){return cu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return uc(t,e)},t.prototype.we=function(t,e){var n,r=ec(t),i=pi.o;return r.$t({index:Za.documentTargetsIndex},(function(t,r){var o=t[0];t[1];var s=r.path,a=r.sequenceNumber;0===o?(i!==pi.o&&e(new $i(Ba(n)),i),i=a,n=s):i=pi.o})).next((function(){i!==pi.o&&e(new $i(Ba(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function uc(t,e){return ec(t).put(function(t,e){return new Za(0,Ua(t.path),e)}(e,t.currentSequenceNumber))}var cc=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Oi(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return Li(this.inner)},t}(),hc=function(){function t(){this.changes=new cc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:xi.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:yo.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?cu.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),lc=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return dc(t).put(yc(e),n)},t.prototype.removeEntry=function(t,e){var n=dc(t),r=yc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return dc(t).get(yc(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return dc(t).get(yc(e)).next((function(t){return{document:n.ye(e,t),size:Gu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Bs();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Bs(),i=new Ms($i.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Gu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return cu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return dc(t).$t({range:r},(function(t,e,r){for(var s=$i.fromSegments(t);o&&$i.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Bs(),o=e.path.length+1,s={};if(n.isEqual(xi.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Nu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Xa.collectionReadTimeIndex}return dc(t).$t(s,(function(t,n,s){if(t.length===o){var a=Su(r.R,n);e.path.isPrefixOf(a.key.path)?Xo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new fc(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return pc(t).get($a.key).next((function(t){return _i(!!t),t}))},t.prototype.me=function(t,e){return pc(t).put($a.key,e)},t.prototype.ye=function(t,e){if(e){var n=Su(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(xi.min()))return n}return yo.newInvalidDocument(t)},t}(),fc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new cc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return n(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Us((function(t,e){return Ni(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Au(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Gu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Au(e.Ie.R,yo.newNoDocument(o,xi.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),cu.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(hc);function pc(t){return wu(t,$a.store)}function dc(t){return wu(t,Xa.store)}function yc(t){return t.path.toArray()}var vc=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;_i(n<r&&n>=0&&r<=11);var o=new hu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(za.store)}(t),function(t){t.createObjectStore(Ga.store,{keyPath:Ga.keyPath}),t.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ha.store)}(t),gc(t),function(t){t.createObjectStore(Xa.store)}(t));var s=cu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Za.store),t.deleteObjectStore(Ja.store),t.deleteObjectStore(tu.store)}(t),gc(t)),s=s.next((function(){return function(t){var e=t.store(tu.store),n=new tu(0,0,xi.min().toTimestamp(),0);return e.put(tu.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Qa.store).Nt().next((function(n){t.deleteObjectStore(Qa.store),t.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0});var r=e.store(Qa.store),i=n.map((function(t){return r.put(t)}));return cu.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(nu.store,{keyPath:nu.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore($a.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Xa.store);e.createIndex(Xa.readTimeIndex,Xa.readTimeIndexPath,{unique:!1}),e.createIndex(Xa.collectionReadTimeIndex,Xa.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ru.store,{keyPath:ru.keyPath})}(t),function(t){t.createObjectStore(iu.store,{keyPath:iu.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Xa.store).$t((function(t,n){e+=Gu(n)})).next((function(){var n=new $a(e);return t.store($a.store).put($a.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Ga.store),r=t.store(Qa.store);return n.Nt().next((function(n){return cu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Qa.userMutationsIndex,i).next((function(r){return cu.forEach(r,(function(r){_i(r.userId===n.userId);var i=xu(e.R,r);return zu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(Za.store),n=t.store(Xa.store);return t.store(tu.store).get(tu.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new Mi(n),s=function(t){return[0,Ua(t)]}(o);r.push(e.get(s).next((function(n){return n?cu.resolve():function(n){return e.put(new Za(0,Ua(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return cu.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(eu.store,{keyPath:eu.keyPath});var n=e.store(eu.store),r=new Uu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ua(i)})}};return e.store(Xa.store).$t({Ft:!0},(function(t,e){var n=new Mi(t);return i(n.popLast())})).next((function(){return e.store(Ha.store).$t({Ft:!0},(function(t,e){t[0];var n=t[1];t[2];var r=Ba(n);return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Ja.store);return n.$t((function(t,r){var i=Ru(r),o=Ou(e.R,i);return n.put(o)}))},t}();function gc(t){t.createObjectStore(Za.store,{keyPath:Za.keyPath}).createIndex(Za.documentTargetsIndex,Za.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ja.store,{keyPath:Ja.keyPath}).createIndex(Ja.queryTargetsIndexName,Ja.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(tu.store)}var mc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new yi(di.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ac(this,i),this.Le=n+"main",this.R=new Tu(u),this.Be=new lu(this.Le,11,new vc(this.R)),this.qe=new Ju(this.referenceDelegate,this.R),this.Ut=new qu,this.Ue=function(t,e){return new lc(t,e)}(this.R,this.Ut),this.Ke=new Pu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&bi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new yi(di.FAILED_PRECONDITION,mc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new pi(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return i(e,void 0,void 0,(function(){return o(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return i(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return i(e,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Ec(e).put(new nu(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(du(e))return mi("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return mi("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return wc(t).get(za.key).next((function(t){return cu.resolve(e.tn(t))}))},t.prototype.en=function(t){return Ec(t).delete(this.clientId)},t.prototype.nn=function(){return i(this,void 0,void 0,(function(){var t,e,n,r,i=this;return o(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=wu(t,nu.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return cu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)r=n[e],this.Qe.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?cu.resolve(!0):wc(t).get(za.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new yi(di.FAILED_PRECONDITION,mc);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ec(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&mi("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[za.store,nu.store],(function(e){var n=new bu(e,pi.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Ec(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Qu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;mi("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,ou,(function(o){return i=new bu(o,r.Ne?r.Ne.next():pi.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw bi("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new yi(di.FAILED_PRECONDITION,su);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return wc(t).get(za.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new yi(di.FAILED_PRECONDITION,mc)}))},t.prototype.Ze=function(t){var e=new za(this.clientId,this.allowTabSynchronization,Date.now());return wc(t).put(za.key,e)},t.yt=function(){return lu.yt()},t.prototype.Xe=function(t){var e=this,n=wc(t);return n.get(za.key).next((function(t){return e.tn(t)?(mi("IndexedDbPersistence","Releasing primary lease."),n.delete(za.key)):cu.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(bi("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),!y()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return mi("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return bi("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){bi("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function wc(t){return wu(t,za.store)}function Ec(t){return wu(t,nu.store)}function Ic(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var _c=function(t,e){this.progress=t,this.wn=e},Tc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return $i.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Ko(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new $i(e)).next((function(t){var e=zs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=zs();return this.Ut.getCollectionParents(t,i).next((function(s){return cu.forEach(s,(function(s){var a=function(t,e){return new Mo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=yo.newInvalidDocument(c),r=r.insert(c,h)),ws(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Xo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Ws(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Ss&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Sc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ws(),i=Ws(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ac=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(xi.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(Uo(e)||qo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(gi()<=k.DEBUG&&mi("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Yo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Us($o(t));return e.forEach((function(e,r){Xo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return gi()<=k.DEBUG&&mi("QueryEngine","Using full collection scan to execute query:",Yo(e)),this.Sn.getDocumentsMatchingQuery(t,e,xi.min())},t}(),Nc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Ms(Ni),this.Fn=new cc((function(t){return mo(t)}),bo),this.$n=xi.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Tc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function Dc(t,e,n,r){return new Nc(t,e,n,r)}function Cc(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return n=Ti(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Tc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Ws(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=e;p<d.length;p++){var y=d[p];r.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return s=o.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),s)]}}))}))}function kc(t,e){var n=Ti(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=cu.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);_i(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function xc(t){var e=Ti(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Rc(t,e){var n=Ti(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return _i(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=Bs();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Oc(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(xi.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return cu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function Oc(t,e,n,r,i){var o=Ws();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Bs();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(xi.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):mi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Lc(t,e){var n=Ti(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Pc(t,e){var n=Ti(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,cu.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new _u(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function Mc(t,e,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:r=Ti(t),i=r.kn.get(e),s=n?"readwrite":"readwrite-primary",o.label=1;case 1:return o.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:o.sent(),o.label=3;case 3:return[3,5];case 4:if(!du(a=o.sent()))throw a;return mi("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}}))}))}function Fc(t,e,n){var r=Ti(t),i=xi.min(),o=Ws();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Ti(t),i=r.Fn.get(n);return void 0!==i?cu.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,Go(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:xi.min(),n?o:Ws())})).next((function(t){return{documents:t,Bn:o}}))}))}function Vc(t,e){var n=Ti(t),r=Ti(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Uc(t){var e=Ti(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Ti(t),i=Bs(),o=Nu(n),s=dc(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Xa.readTimeIndex,range:a},(function(t,e){var n=Su(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Du(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn,r=t.readTime;return e.$n=r,n}))}function qc(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){return[2,(e=Ti(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=dc(t),n=xi.min();return e.$t({index:Xa.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Du(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function jc(t,e,n,r){return i(this,void 0,void 0,(function(){var i,s,a,u,c,h,l,f,p,d;return o(this,(function(o){switch(o.label){case 0:for(i=Ti(t),s=Ws(),a=Bs(),u=Qs(),c=0,h=n;c<h.length;c++)l=h[c],f=e.qn(l.metadata.name),l.document&&(s=s.add(f)),a=a.insert(f,e.Un(l)),u=u.insert(f,e.Kn(l.metadata.readTime));return p=i.On.newChangeBuffer({trackRemovals:!0}),[4,Pc(i,function(t){return Go(Vo(Mi.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=o.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Oc(t,p,a,xi.min(),u).next((function(e){return p.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,s,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Bc(t,e,n){return void 0===n&&(n=Ws()),i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return[4,Pc(t,Go(Lu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Ti(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=fa(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(qi.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var Kc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return cu.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:fa(n.createTime)}),cu.resolve()},t.prototype.getNamedQuery=function(t,e){return cu.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Lu(t.bundledQuery),readTime:fa(t.readTime)}}(e)),cu.resolve()},t}(),zc=function(){function t(){this.Wn=new Us(Gc.Gn),this.zn=new Us(Gc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Gc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Gc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new $i(new Mi([])),r=new Gc(n,t),i=new Gc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new $i(new Mi([])),n=new Gc(e,t),r=new Gc(e,t+1),i=Ws();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Gc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Gc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return $i.comparator(t.key,e.key)||Ni(t.ns,e.ns)},t.Hn=function(t,e){return Ni(t.ns,e.ns)||$i.comparator(t.key,e.key)},t}(),Qc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Us(Gc.Gn)}return t.prototype.checkEmpty=function(t){return cu.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Eu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Gc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return cu.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return cu.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return cu.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return cu.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return cu.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Gc(e,0),i=new Gc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),cu.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Us(Ni);return e.forEach((function(t){var e=new Gc(t,0),i=new Gc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),cu.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;$i.isDocumentKey(i)||(i=i.child(""));var o=new Gc(new $i(i),0),s=new Us(Ni);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),cu.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;_i(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return cu.forEach(e.mutations,(function(i){var o=new Gc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Gc(e,0),r=this.rs.firstAfterOrEqual(n);return cu.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,cu.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Hc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ms($i.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return cu.resolve(n?n.document.clone():yo.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Bs();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():yo.newInvalidDocument(t))})),cu.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Bs(),i=new $i(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||Xo(e,c)&&(r=r.insert(c.key,c.clone()))}return cu.resolve(r)},t.prototype.fs=function(t,e){return cu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Wc(this)},t.prototype.getSize=function(t){return cu.resolve(this.size)},t}(),Wc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return n(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),cu.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(hc),Yc=function(){function t(t){this.persistence=t,this.ds=new cc((function(t){return mo(t)}),bo),this.lastRemoteSnapshotVersion=xi.min(),this.highestTargetId=0,this.ws=0,this._s=new zc,this.targetCount=0,this.ys=$u.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),cu.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return cu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return cu.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),cu.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),cu.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new $u(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,cu.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),cu.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,cu.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),cu.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return cu.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return cu.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),cu.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),cu.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),cu.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return cu.resolve(n)},t.prototype.containsKey=function(t,e){return cu.resolve(this._s.containsKey(e))},t}(),Xc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new pi(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Yc(this),this.Ut=new Vu,this.Ue=function(t,e){return new Hc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Tu(e),this.Ke=new Kc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Qc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;mi("MemoryPersistence","Starting transaction:",t);var i=new $c(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return cu.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),$c=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return n(e,t),e}(au),Jc=function(){function t(t){this.persistence=t,this.As=new zc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Ii()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),cu.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),cu.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),cu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return cu.forEach(this.vs,(function(r){var i=$i.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return cu.or([function(){return cu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Zc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function th(t,e){return"firestore_clients_"+t+"_"+e}function eh(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function nh(t,e){return"firestore_targets_"+t+"_"+e}Zc.UNAUTHENTICATED=new Zc(null),Zc.GOOGLE_CREDENTIALS=new Zc("google-credentials-uid"),Zc.FIRST_PARTY=new Zc("first-party-uid"),Zc.MOCK_USER=new Zc("mock-user");var rh=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new yi(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(bi("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ih=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new yi(i.error.code,i.error.message)),o?new t(e,i.state,r):(bi("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),oh=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Xs(),s=0;i&&s<r.activeTargetIds.length;++s)i=Xi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(bi("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),sh=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(bi("SharedClientState","Failed to parse online state: "+e),null)},t}(),ah=function(){function t(){this.activeTargetIds=Xs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),uh=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Ms(Ni),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=th(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new ah),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return i(this,void 0,void 0,(function(){var t,e,n,r,i,s,a,u,c,h,l,f=this;return o(this,(function(o){switch(o.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=o.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(th(this.persistenceKey,r)))&&(s=oh.Vs(r,i))&&(this.Fs=this.Fs.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)l=h[c],this.ks(l);return this.$s=[],this.window.addEventListener("pagehide",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(nh(this.persistenceKey,t));if(n){var r=ih.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(nh(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return mi("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){mi("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){mi("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(mi("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void bi("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return i(e,void 0,void 0,(function(){var t,e,r,i,s,a;return o(this,(function(o){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(s=this.js(n.newValue)))return[2,this.Ws(s)]}else if(n.key===this.Ms)(a=function(t){var e=pi.o;if(null!=t)try{var n=JSON.parse(t);_i("number"==typeof n),e=n}catch(t){bi("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==pi.o&&this.sequenceNumberHandler(a);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new rh(this.currentUser,t,e,n),i=eh(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=eh(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=nh(this.persistenceKey,t),i=new ih(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return oh.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return rh.Vs(new Zc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return ih.Vs(r,e)},t.prototype.js=function(t){return sh.Vs(t)},t.prototype.ii=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(mi("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Xs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),ch=function(){function t(){this.li=new ah,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new ah,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),hh=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),lh=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){mi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){mi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),fh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ph=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),dh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return n(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new fi;s.listenOnce(si.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case oi.NO_ERROR:var e=s.getResponseJson();mi("Connection","XHR received:",JSON.stringify(e)),i(e);break;case oi.TIMEOUT:mi("Connection",'RPC "'+t+'" timed out'),o(new yi(di.DEADLINE_EXCEEDED,"Request time out"));break;case oi.HTTP_ERROR:var n=s.getStatus();if(mi("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(di).indexOf(e)>=0?e:di.UNKNOWN}(r.status);o(new yi(a,r.message))}else o(new yi(di.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new yi(di.UNAVAILABLE,"Connection failed."));break;default:Ii()}}finally{mi("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new ti,o=Qe(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new hi({})),this.ki(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||d().indexOf("Electron/")>=0||function(){var t=d();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||d().indexOf("MSAppHost/")>=0||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var a=r.join("");mi("Connection","Creating WebChannel: "+a,s);var u=i.createWebChannel(a,s),c=!1,h=!1,l=new ph({Ei:function(t){h?mi("Connection","Not sending because WebChannel is closed:",t):(c||(mi("Connection","Opening WebChannel transport."),u.open(),c=!0),mi("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,li.EventType.OPEN,(function(){h||mi("Connection","WebChannel transport opened.")})),f(u,li.EventType.CLOSE,(function(){h||(h=!0,mi("Connection","WebChannel transport closed"),l.Vi())})),f(u,li.EventType.ERROR,(function(t){h||(h=!0,wi("Connection","WebChannel transport errored:",t),l.Vi(new yi(di.UNAVAILABLE,"The operation could not be completed")))})),f(u,li.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];_i(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){mi("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Cs[t];if(void 0!==e)return Ps(e)}(o),a=i.message;void 0===s&&(s=di.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new yi(s,a)),u.close()}else mi("Connection","WebChannel received:",n),l.Si(n)}})),f(o,ai.STAT_EVENT,(function(t){t.stat===ui?mi("Connection","Detected buffering proxy"):t.stat===ci&&mi("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);mi("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return mi("RestConnection","Received: ",t),t}),(function(e){throw wi("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=fh[t];return this.Di+"/v1/"+e+":"+n},t}());function yh(){return"undefined"!=typeof window?window:null}function vh(){return"undefined"!=typeof document?document:null}function gh(t){return new ua(t,!0)}var mh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&mi("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),bh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new mh(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===di.RESOURCE_EXHAUSTED?(bi(e.toString()),bi("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===di.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new yi(di.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return i(t,void 0,void 0,(function(){return o(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return mi("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(mi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),wh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return n(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ii()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(_i(void 0===e||"string"==typeof e),qi.fromBase64String(e||"")):(_i(void 0===e||e instanceof Uint8Array),qi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?di.UNKNOWN:Ps(t.code);return new yi(e,t.message||"")}(a);n=new ea(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=va(t,r.document.name),o=fa(r.document.updateTime);var a=new fo({mapValue:{fields:r.document.fields}}),u=(s=yo.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new Zs(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=va(t,r.document),o=r.readTime?fa(r.readTime):xi.min(),a=yo.newNoDocument(i,o),s=r.removedTargetIds||[],n=new Zs([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=va(t,r.document),o=r.removedTargetIds||[],n=new Zs([],o,i,null);else{if(!("filter"in e))return Ii();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new Os(r),o=h.targetId,n=new ta(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return xi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?xi.min():e.readTime?fa(e.readTime):xi.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=ba(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=wo(r)?{documents:Sa(t,r)}:{query:Aa(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ha(t,e.resumeToken):e.snapshotVersion.compareTo(xi.min())>0&&(n.readTime=ca(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ii()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=ba(this.R),e.removeTarget=t,this.cr(e)},e}(bh),Eh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return n(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(_i(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(_i(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?fa(t.updateTime):fa(e);return n.isEqual(xi.min())&&(n=fa(e)),new ys(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=fa(t.commitTime);return this.listener.Tr(n,e)}return _i(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=ba(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return _a(e.R,t)}))};this.cr(n)},e}(bh),Ih=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return n(e,t),e.prototype.br=function(){if(this.Rr)throw new yi(di.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===di.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new yi(di.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===di.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new yi(di.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),_h=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(bi(e),this.Vr=!1):mi("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Th=function(t,e,n,r,s){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=s,this.Lr.di((function(t){n.enqueueAndForget((function(){return i(a,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return Oh(this)?(mi("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return(e=Ti(t)).Or.add(4),[4,Ah(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Sh(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new _h(n,r)};function Sh(t){return i(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:if(!Oh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Ah(t){return i(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Nh(t,e){var n=Ti(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Rh(n)?xh(n):Wh(n).er()&&Ch(n,e))}function Dh(t,e){var n=Ti(t),r=Wh(n);n.$r.delete(e),r.er()&&kh(n,e),0===n.$r.size&&(r.er()?r.ir():Oh(n)&&n.Br.set("Unknown"))}function Ch(t,e){t.qr.U(e.targetId),Wh(t).mr(e)}function kh(t,e){t.qr.U(e),Wh(t).yr(e)}function xh(t){t.qr=new ra({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Wh(t).start(),t.Br.Sr()}function Rh(t){return Oh(t)&&!Wh(t).tr()&&t.$r.size>0}function Oh(t){return 0===Ti(t).Or.size}function Lh(t){t.qr=void 0}function Ph(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return t.$r.forEach((function(e,n){Ch(t,e)})),[2]}))}))}function Mh(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){return Lh(t),Rh(t)?(t.Br.Nr(e),xh(t)):t.Br.set("Unknown"),[2]}))}))}function Fh(t,e,n){return i(this,void 0,void 0,(function(){var r,s,a;return o(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof ea&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s;return o(this,(function(o){switch(o.label){case 0:n=e.cause,r=0,i=e.targetIds,o.label=1;case 1:return r<i.length?(s=i[r],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:o.sent(),t.$r.delete(s),t.qr.removeTarget(s),o.label=3;case 3:o.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return r=u.sent(),mi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Vh(t,r)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Zs?t.qr.X(e):e instanceof ta?t.qr.rt(e):t.qr.et(e),n.isEqual(xi.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,xc(t.localStore)];case 8:return s=u.sent(),n.compareTo(s)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(qi.EMPTY_BYTE_STRING,n.snapshotVersion)),kh(t,e);var r=new _u(n.target,e,1,n.sequenceNumber);Ch(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return mi("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,Vh(t,a)];case 12:return u.sent(),[3,13];case 13:return[2]}}))}))}function Vh(t,e,n){return i(this,void 0,void 0,(function(){var r=this;return o(this,(function(s){switch(s.label){case 0:if(!du(e))throw e;return t.Or.add(1),[4,Ah(t)];case 1:return s.sent(),t.Br.set("Offline"),n||(n=function(){return xc(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return mi("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Sh(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Uh(t,e){return e().catch((function(n){return Vh(t,n,e)}))}function qh(t){return i(this,void 0,void 0,(function(){var e,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:e=Ti(t),n=Yh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,o.label=1;case 1:if(!function(t){return Oh(t)&&t.Fr.length<10}(e))return[3,7];o.label=2;case 2:return o.trys.push([2,4,,6]),[4,Lc(e.localStore,r)];case 3:return null===(i=o.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=Yh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return s=o.sent(),[4,Vh(e,s)];case 5:return o.sent(),[3,6];case 6:return[3,1];case 7:return jh(e)&&Bh(e),[2]}}))}))}function jh(t){return Oh(t)&&!Yh(t).tr()&&t.Fr.length>0}function Bh(t){Yh(t).start()}function Kh(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return Yh(t).Ar(),[2]}))}))}function zh(t){return i(this,void 0,void 0,(function(){var e,n,r,i;return o(this,(function(o){for(e=Yh(t),n=0,r=t.Fr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}function Gh(t,e,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=Iu.from(r,e,n),[4,Uh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,qh(t)];case 2:return o.sent(),[2]}}))}))}function Qh(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return e&&Yh(t).pr?[4,function(t,e){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:return Ls(r=e.code)&&r!==di.ABORTED?(n=t.Fr.shift(),Yh(t).sr(),[4,Uh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,qh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return jh(t)&&Bh(t),[2]}}))}))}function Hh(t,e){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return n=Ti(t),e?(n.Or.delete(2),[4,Sh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Ah(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Wh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Ti(t);return r.br(),new wh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ph.bind(null,t),Ri:Mh.bind(null,t),_r:Fh.bind(null,t)}),t.Mr.push((function(n){return i(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Rh(t)?xh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Lh(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function Yh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Ti(t);return r.br(),new Eh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Kh.bind(null,t),Ri:Qh.bind(null,t),Ir:zh.bind(null,t),Tr:Gh.bind(null,t)}),t.Mr.push((function(n){return i(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,qh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(mi("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var Xh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new uu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new yi(di.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function $h(t,e){if(bi("AsyncQueue",e+": "+t),du(t))return new yi(di.UNAVAILABLE,e+": "+t);throw t}var Jh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||$i.comparator(e.key,n.key)}:function(t,e){return $i.comparator(t.key,e.key)},this.keyedMap=zs(),this.sortedSet=new Ms(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Zh=function(){function t(){this.Qr=new Ms($i.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Ii():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),tl=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Jh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ho(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),el=function(){this.Wr=void 0,this.listeners=[]},nl=function(){this.queries=new cc((function(t){return Wo(t)}),Ho),this.onlineState="Unknown",this.Gr=new Set};function rl(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c;return o(this,(function(o){switch(o.label){case 0:if(n=Ti(t),r=e.query,i=!1,(s=n.queries.get(r))||(i=!0,s=new el),!i)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),a=s,[4,n.onListen(r)];case 2:return a.Wr=o.sent(),[3,4];case 3:return u=o.sent(),c=$h(u,"Initialization of query '"+Yo(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&al(n),[2]}}))}))}function il(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){return n=Ti(t),r=e.query,i=!1,(s=n.queries.get(r))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),i=0===s.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function ol(t,e){for(var n=Ti(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&al(n)}function sl(t,e,n){var r=Ti(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function al(t){t.Gr.forEach((function(t){t.next()}))}var ul=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new tl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=tl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),cl=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),hl=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return va(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ia(this.R,t.document,!1):yo.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return fa(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new hl(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ws()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return i(this,void 0,void 0,(function(){var t,e,n,r,i;return o(this,(function(o){switch(o.label){case 0:return[4,jc(this.localStore,new hl(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,Bc(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new _c(Object.assign({},this.progress),t))]}}))}))}}();var ll=function(t){this.key=t},fl=function(t){this.key=t},pl=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ws(),this.mutatedKeys=Ws(),this.lo=$o(t),this.fo=new Jh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Zh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Uo(this.query)&&i.size===this.query.limit?i.last():null,c=qo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Xo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data.isEqual(l.data)?f!==p&&(r.track({type:3,doc:l}),d=!0):n.yo(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Uo(this.query)||qo(this.query))for(;s.size>this.query.limit;){var h=Uo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ii()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new tl(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Zh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ws(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new fl(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new ll(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ws();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return tl.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),dl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},yl=function(t){this.key=t,this.bo=!1},vl=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new cc((function(t){return Wo(t)}),Ho),this.Vo=new Map,this.So=new Set,this.Do=new Ms($i.comparator),this.Co=new Map,this.No=new zc,this.xo={},this.ko=new Map,this.Fo=$u.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function gl(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u;return o(this,(function(o){switch(o.label){case 0:return n=Ql(t),(s=n.Po.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ro(),[3,4]):[3,1];case 1:return[4,Pc(n.localStore,Go(e))];case 2:return a=o.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.targetId,[4,ml(n,e,r,"current"===u)];case 3:i=o.sent(),n.isPrimaryClient&&Nh(n.remoteStore,a),o.label=4;case 4:return[2,i]}}))}))}function ml(t,e,n,r){return i(this,void 0,void 0,(function(){var s,a,u,c,h,l;return o(this,(function(f){switch(f.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return i(this,void 0,void 0,(function(){var i,s,a;return o(this,(function(o){switch(o.label){case 0:return(i=e.view._o(n)).Nn?[4,Fc(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,i)}))]:[3,2];case 1:i=o.sent(),o.label=2;case 2:return s=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s),[2,(xl(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,n,r)},[4,Fc(t.localStore,e,!0)];case 1:return s=f.sent(),a=new pl(e,s.Bn),u=a._o(s.documents),c=Js.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),h=a.applyChanges(u,t.isPrimaryClient,c),xl(t,n,h.To),l=new dl(e,n,a),[2,(t.Po.set(e,l),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),h.snapshot)]}}))}))}function bl(t,e){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return n=Ti(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Ho(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Mc(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Dh(n.remoteStore,r.targetId),Cl(n,r.targetId)})).catch(nc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Cl(n,r.targetId),[4,Mc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function wl(t,e,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:r=Hl(t),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,function(t,e){var n,r=Ti(t),i=ki.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Ws());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Es(c,n.get(c.key));null!=h&&s.push(new Ss(c.key,h,po(h.value.mapValue),vs.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=o.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ms(Ni)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Ll(r,i.changes)];case 3:return o.sent(),[4,qh(r.remoteStore)];case 4:return o.sent(),[3,6];case 5:return s=o.sent(),a=$h(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}}))}))}function El(t,e){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:n=Ti(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Rc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(_i(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?_i(r.bo):t.removedDocuments.size>0&&(_i(r.bo),r.bo=!1))})),[4,Ll(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,nc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Il(t,e,n){var r=Ti(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Ti(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&al(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function _l(t,e,n){return i(this,void 0,void 0,(function(){var r,i,s,a,u,c;return o(this,(function(o){switch(o.label){case 0:return(r=Ti(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(s=i&&i.key)?(a=(a=new Ms($i.comparator)).insert(s,yo.newNoDocument(s,xi.min())),u=Ws().add(s),c=new $s(xi.min(),new Map,new Us(Ni),a,u),[4,El(r,c)]):[3,2];case 1:return o.sent(),r.Do=r.Do.remove(s),r.Co.delete(e),Ol(r),[3,4];case 2:return[4,Mc(r.localStore,e,!1).then((function(){return Cl(r,e,n)})).catch(nc)];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))}function Tl(t,e){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:n=Ti(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,kc(n.localStore,e)];case 2:return i=o.sent(),Dl(n,r,null),Nl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Ll(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,nc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Sl(t,e,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:r=Ti(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Ti(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return _i(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Dl(r,e,n),Nl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Ll(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,nc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Al(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:Oh((n=Ti(t)).remoteStore)||mi("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,function(t){var e=Ti(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=o.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return s=o.sent(),a=$h(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}}))}))}function Nl(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function Dl(t,e,n){var r=Ti(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Cl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||kl(t,e)}))}function kl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Dh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Ol(t))}function xl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ll?(t.No.addReference(o.key,e),Rl(t,o)):o instanceof fl?(mi("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||kl(t,o.key)):Ii()}}function Rl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(mi("SyncEngine","New document in limbo: "+n),t.So.add(r),Ol(t))}function Ol(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new $i(Mi.fromString(e)),r=t.Fo.next();t.Co.set(r,new yl(n)),t.Do=t.Do.insert(n,r),Nh(t.remoteStore,new _u(Go(Vo(n.path)),r,2,pi.o))}}function Ll(t,e,n){return i(this,void 0,void 0,(function(){var r,s,a,u;return o(this,(function(c){switch(c.label){case 0:return r=Ti(t),s=[],a=[],u=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,i){u.push(r.Oo(i,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(i.targetId,t.fromCache?"not-current":"current"),s.push(t);var e=Sc.Pn(i.targetId,t);a.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),r.vo._r(s),[4,function(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c,h,l;return o(this,(function(o){switch(o.label){case 0:n=Ti(t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return cu.forEach(e,(function(e){return cu.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return cu.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return o.sent(),[3,4];case 3:if(!du(r=o.sent()))throw r;return mi("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,s=e;i<s.length;i++)a=s[i],u=a.targetId,a.fromCache||(c=n.kn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.kn=n.kn.insert(u,l));return[2]}}))}))}(r.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Pl(t,e){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:return(n=Ti(t)).currentUser.isEqual(e)?[3,3]:(mi("SyncEngine","User change. New user:",e.toKey()),[4,Cc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new yi(di.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Ll(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Ml(t,e){var n=Ti(t),r=n.Co.get(e);if(r&&r.bo)return Ws().add(r.key);var i=Ws(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Fl(t,e){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return[4,Fc((n=Ti(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&xl(n,e.targetId,i.To),i)]}}))}))}function Vl(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){return[2,Uc((e=Ti(t)).localStore).then((function(t){return Ll(e,t)}))]}))}))}function Ul(t,e,n,r){return i(this,void 0,void 0,(function(){var i,s;return o(this,(function(o){switch(o.label){case 0:return[4,function(t,e){var n=Ti(t),r=Ti(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):cu.resolve(null)}))}))}((i=Ti(t)).localStore,e)];case 1:return null===(s=o.sent())?[3,6]:"pending"!==n?[3,3]:[4,qh(i.remoteStore)];case 2:return o.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Dl(i,e,r||null),Nl(i,e),function(t,e){Ti(Ti(t)._n).Gt(e)}(i.localStore,e)):Ii(),o.label=4;case 4:return[4,Ll(i,s)];case 5:return o.sent(),[3,7];case 6:mi("SyncEngine","Cannot apply mutation batch with id: "+e),o.label=7;case 7:return[2]}}))}))}function ql(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c,h;return o(this,(function(o){switch(o.label){case 0:return Ql(n=Ti(t)),Hl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,jl(n,r.toArray())]);case 1:return i=o.sent(),n.$o=!0,[4,Hh(n.remoteStore,!0)];case 2:for(o.sent(),s=0,a=i;s<a.length;s++)u=a[s],Nh(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return Cl(n,e),Mc(n.localStore,e,!0)})),Dh(n.remoteStore,e)})),[4,h]);case 4:return o.sent(),[4,jl(n,c)];case 5:return o.sent(),function(t){var e=Ti(t);e.Co.forEach((function(t,n){Dh(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Ms($i.comparator)}(n),n.$o=!1,[4,Hh(n.remoteStore,!1)];case 6:o.sent(),o.label=7;case 7:return[2]}}))}))}function jl(t,e,n){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c,h,l,f,p,d,y,v;return o(this,(function(o){switch(o.label){case 0:n=Ti(t),r=[],i=[],s=0,a=e,o.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,Pc(n.localStore,Go(h[0]))]:[3,7]):[3,13];case 2:c=o.sent(),l=0,f=h,o.label=3;case 3:return l<f.length?(p=f[l],d=n.Po.get(p),[4,Fl(n,d)]):[3,6];case 4:(y=o.sent()).snapshot&&i.push(y.snapshot),o.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,Vc(n.localStore,u)];case 8:return v=o.sent(),[4,Pc(n.localStore,v)];case 9:return c=o.sent(),[4,ml(n,Bl(v),u,!1)];case 10:o.sent(),o.label=11;case 11:r.push(c),o.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Bl(t){return Fo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Kl(t){var e=Ti(t);return Ti(Ti(e.localStore).persistence).fn()}function zl(t,e,n,r){return i(this,void 0,void 0,(function(){var i,s,a;return o(this,(function(o){switch(o.label){case 0:return(i=Ti(t)).$o?(mi("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Uc(i.localStore)];case 3:return s=o.sent(),a=$s.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Ll(i,s,a)];case 4:return o.sent(),[3,8];case 5:return[4,Mc(i.localStore,e,!0)];case 6:return o.sent(),Cl(i,e,r),[3,8];case 7:Ii(),o.label=8;case 8:return[2]}}))}))}function Gl(t,e,n){return i(this,void 0,void 0,(function(){var r,i,s,a,u,c,h,l,f,p;return o(this,(function(d){switch(d.label){case 0:if(!(r=Ql(t)).$o)return[3,10];i=0,s=e,d.label=1;case 1:return i<s.length?(a=s[i],r.Vo.has(a)?(mi("SyncEngine","Adding an already active target "+a),[3,5]):[4,Vc(r.localStore,a)]):[3,6];case 2:return u=d.sent(),[4,Pc(r.localStore,u)];case 3:return c=d.sent(),[4,ml(r,Bl(u),c.targetId,!1)];case 4:d.sent(),Nh(r.remoteStore,c),d.label=5;case 5:return i++,[3,1];case 6:h=function(t){return o(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Mc(r.localStore,t,!1).then((function(){Dh(r.remoteStore,t),Cl(r,t)})).catch(nc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,d.label=7;case 7:return l<f.length?(p=f[l],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function Ql(t){var e=Ti(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=El.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ml.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_l.bind(null,e),e.vo._r=ol.bind(null,e.eventManager),e.vo.Mo=sl.bind(null,e.eventManager),e}function Hl(t){var e=Ti(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Tl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Sl.bind(null,e),e}var Wl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.R=gh(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Dc(this.persistence,new Ac,t.initialUser,this.R)},t.prototype.qo=function(t){return new Xc(Jc.bs,this.R)},t.prototype.Bo=function(t){return new ch},t.prototype.terminate=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Yl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return n(e,t),e.prototype.initialize=function(e){return i(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,qc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,Hl(this.Qo.syncEngine)];case 4:return r.sent(),[4,qh(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return Dc(this.persistence,new Ac,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new oc(e,t.asyncQueue)},e.prototype.qo=function(t){var e=Ic(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ku.withCacheSize(this.cacheSizeBytes):Ku.DEFAULT;return new bc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,yh(),vh(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new ch},e}(Wl),Xl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return n(e,t),e.prototype.initialize=function(e){return i(this,void 0,void 0,(function(){var n,r=this;return o(this,(function(s){switch(s.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return s.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof uh?(this.sharedClientState.syncEngine={ui:Ul.bind(null,n),ai:zl.bind(null,n),hi:Gl.bind(null,n),fn:Kl.bind(null,n),ci:Vl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[4,this.persistence.He((function(t){return i(r,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,ql(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return s.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=yh();if(!uh.yt(e))throw new yi(di.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ic(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new uh(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Yl),$l=function(){function t(){}return t.prototype.initialize=function(t,e){return i(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Il(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Pl.bind(null,this.syncEngine),[4,Hh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new nl},t.prototype.createDatastore=function(t){var e,n=gh(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new dh(e));return function(t,e,n){return new Ih(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Il(s.syncEngine,t,0)},o=lh.yt()?new lh:new hh,new Th(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new vl(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=Ti(t),mi("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Ah(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),Jl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Zl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new uu,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return i(this,void 0,void 0,(function(){var t,e,n,r;return o(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new cl(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return i(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return i(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return i(this,void 0,void 0,(function(){var e,n=this;return o(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new yi(di.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u;return o(this,(function(o){switch(o.label){case 0:return n=Ti(t),r=ba(n.R)+"/documents",i={documents:e.map((function(t){return ya(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return s=o.sent(),a=new Map,s.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){_i(!!e.found),e.found.name,e.found.updateTime;var n=va(t,e.found.name),r=fa(e.found.updateTime),i=new fo({mapValue:{fields:e.found.fields}});return yo.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){_i(!!e.missing),_i(!!e.readTime);var n=va(t,e.missing),r=fa(e.readTime);return yo.newNoDocument(n,r)}(t,e):Ii()}(n.R,t);a.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());_i(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new xs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return i(this,void 0,void 0,(function(){var t,e=this;return o(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=$i.fromPath(n);e.mutations.push(new Rs(r,e.precondition(r)))})),[4,function(t,e){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return n=Ti(t),r=ba(n.R)+"/documents",i={writes:e.map((function(t){return _a(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Ii();e=xi.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new yi(di.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?vs.updateTime(e):vs.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(xi.min()))throw new yi(di.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vs.updateTime(e)}return vs.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),tf=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new mh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return i(t,void 0,void 0,(function(){var t,e,n=this;return o(this,(function(r){return t=new Zl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Wi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ls(e)}return!1},t}(),ef=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Zc.UNAUTHENTICATED,this.clientId=Ai.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return i(r,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return mi("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new yi(di.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new uu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return i(t,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=$h(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function nf(t,e){return i(this,void 0,void 0,(function(){var n,r,s=this;return o(this,(function(a){switch(a.label){case 0:return t.asyncQueue.verifyOperationInProgress(),mi("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=a.sent(),[4,e.initialize(n)];case 2:return a.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return i(s,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Cc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function rf(t,e){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,of(t)];case 1:return n=s.sent(),mi("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=s.sent(),[4,e.initialize(n,r)];case 3:return s.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:return(n=Ti(t)).asyncQueue.verifyOperationInProgress(),mi("RemoteStore","RemoteStore received new credentials"),r=Oh(n),n.Or.add(3),[4,Ah(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Sh(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function of(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(mi("FirestoreClient","Using default OfflineComponentProvider"),[4,nf(t,new Wl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function sf(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(mi("FirestoreClient","Using default OnlineComponentProvider"),[4,rf(t,new $l)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function af(t){return of(t).then((function(t){return t.persistence}))}function uf(t){return of(t).then((function(t){return t.localStore}))}function cf(t){return sf(t).then((function(t){return t.remoteStore}))}function hf(t){return sf(t).then((function(t){return t.syncEngine}))}function lf(t){return i(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return[4,sf(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=gl.bind(null,e.syncEngine),n.onUnlisten=bl.bind(null,e.syncEngine),n)]}}))}))}function ff(t,e,n){var r=this;void 0===n&&(n={});var s=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(r,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new Jl({next:function(o){e.enqueueAndForget((function(){return il(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new yi(di.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new yi(di.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new ul(Vo(n.path),o,{includeMetadataChanges:!0,so:!0});return rl(t,s)},[4,lf(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}function pf(t,e,n){var r=this;void 0===n&&(n={});var s=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(r,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new Jl({next:function(n){e.enqueueAndForget((function(){return il(t,s)})),n.fromCache&&"server"===r.source?i.reject(new yi(di.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new ul(n,o,{includeMetadataChanges:!0,so:!0});return rl(t,s)},[4,lf(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}var df=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},yf=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),vf=new Map,gf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},mf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(Zc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),bf=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),wf=function(){function t(t){var e=this;this.currentUser=Zc.UNAUTHENTICATED,this.oc=new uu,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){mi("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(mi("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(mi("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(_i("string"==typeof n.accessToken),new gf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return i(n,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return _i(null===t||"string"==typeof t),new Zc(t)},t}(),Ef=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Zc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),If=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Ef(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(Zc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function _f(t,e,n){if(!n)throw new yi(di.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Tf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new yi(di.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Sf(t,e,n,r){if(!0===e&&!0===r)throw new yi(di.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Af(t){if(!$i.isDocumentKey(t))throw new yi(di.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Nf(t){if($i.isDocumentKey(t))throw new yi(di.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Df(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Ii()}function Cf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new yi(di.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Df(t);throw new yi(di.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function kf(t,e){if(e<=0)throw new yi(di.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var xf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new yi(di.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new yi(di.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Sf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Rf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xf({}),this._settingsFrozen=!1,t instanceof yf?(this._databaseId=t,this._credentials=new mf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new yi(di.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yf(t.options.projectId)}(t),this._credentials=new wf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new yi(di.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new yi(di.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new mf;switch(t.type){case"gapi":var e=t.client;return _i(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new If(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new yi(di.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=vf.get(this))&&(mi("ComponentProvider","Removing Datastore"),vf.delete(this),t.terminate()),Promise.resolve();var t},t}(),Of=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Pf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Lf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Pf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Vo(r))||this)._path=r,i.type="collection",i}return n(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Of(this.firestore,null,new $i(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Lf);function Mf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=_(t),_f("collection","path",e),t instanceof Rf)return Nf(n=Mi.fromString.apply(Mi,u([e],r))),new Pf(t,null,n);if(!(t instanceof Of||t instanceof Pf))throw new yi(di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Nf(n=Mi.fromString.apply(Mi,u([t.path],r)).child(Mi.fromString(e))),new Pf(t.firestore,null,n)}function Ff(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=_(t),1===arguments.length&&(e=Ai.u()),_f("doc","path",e),t instanceof Rf)return Af(n=Mi.fromString.apply(Mi,u([e],r))),new Of(t,null,new $i(n));if(!(t instanceof Of||t instanceof Pf))throw new yi(di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Af(n=t._path.child(Mi.fromString.apply(Mi,u([e],r)))),new Of(t.firestore,t instanceof Pf?t.converter:null,new $i(n))}function Vf(t,e){return t=_(t),e=_(e),(t instanceof Of||t instanceof Pf)&&(e instanceof Of||e instanceof Pf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Uf(t,e){return t=_(t),e=_(e),t instanceof Lf&&e instanceof Lf&&t.firestore===e.firestore&&Ho(t._query,e._query)&&t.converter===e.converter}var qf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new mh(this,"async_queue_retry"),this.Ic=function(){var e=vh();e&&mi("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=vh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=vh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new uu;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return i(this,void 0,void 0,(function(){var t,e=this;return o(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!du(t=n.sent()))throw t;return mi("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,bi("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Xh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Ii()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function jf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new uu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new qf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return n(e,t),e.prototype._terminate=function(){return this._firestoreClient||zf(this),this._firestoreClient.terminate()},e}(Rf);function Kf(t){return t._firestoreClient||zf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function zf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new df(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ef(t._credentials,t._queue,r)}function Gf(t,e,n){var r=this,s=new uu;return t.asyncQueue.enqueue((function(){return i(r,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,nf(t,n)];case 1:return i.sent(),[4,rf(t,e)];case 2:return i.sent(),s.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===di.FAILED_PRECONDITION||t.code===di.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=i.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),s.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return s.promise}))}function Qf(t){if(t._initialized||t._terminated)throw new yi(di.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Hf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new yi(di.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Wf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(qi.fromBase64String(e))}catch(e){throw new yi(di.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(qi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Yf=function(t){this._methodName=t},Xf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new yi(di.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new yi(di.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Ni(this._lat,t._lat)||Ni(this._long,t._long)},t}(),$f=/^__.*__$/,Jf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Ss(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ts(t,this.data,e,this.fieldTransforms)},t}(),Zf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Ss(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function tp(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ii()}}var ep=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return Ep(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(tp(this.Nc)&&$f.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),np=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||gh(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new ep({Nc:t,methodName:e,qc:n,path:Vi.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function rp(t){var e=t._freezeSettings(),n=gh(t._databaseId);return new np(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ip(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);gp("Data must be an object, but it was:",s,r);var a,u,c=yp(r,s);if(o.merge)a=new Ui(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=mp(e,f[l],n);if(!s.contains(p))throw new yi(di.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Ip(h,p)||h.push(p)}a=new Ui(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Jf(new fo(c),a,u)}var op=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Yf);function sp(t,e,n){return new ep({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var ap=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._toFieldTransform=function(t){return new ds(t.path,new ss)},e.prototype.isEqual=function(t){return t instanceof e},e}(Yf),up=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return n(e,t),e.prototype._toFieldTransform=function(t){var e=sp(this,t,!0),n=this.Kc.map((function(t){return dp(t,e)})),r=new as(n);return new ds(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Yf),cp=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return n(e,t),e.prototype._toFieldTransform=function(t){var e=sp(this,t,!0),n=this.Kc.map((function(t){return dp(t,e)})),r=new cs(n);return new ds(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Yf),hp=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return n(e,t),e.prototype._toFieldTransform=function(t){var e=new ls(t.R,es(t.R,this.Qc));return new ds(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Yf);function lp(t,e,n,r){var i=t.Uc(1,e,n);gp("Data must be an object, but it was:",i,r);var o=[],s=fo.empty();Oi(r,(function(t,r){var a=wp(e,t,n);r=_(r);var u=i.Oc(a);if(r instanceof op)o.push(a);else{var c=dp(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Ui(o);return new Zf(s,a,i.fieldTransforms)}function fp(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[mp(e,r,n)],u=[i];if(o.length%2!=0)throw new yi(di.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(mp(e,o[c])),u.push(o[c+1]);for(var h=[],l=fo.empty(),f=a.length-1;f>=0;--f)if(!Ip(h,a[f])){var p=a[f],d=u[f];d=_(d);var y=s.Oc(p);if(d instanceof op)h.push(p);else{var v=dp(d,y);null!=v&&(h.push(p),l.set(p,v))}}var g=new Ui(h);return new Zf(l,g,s.fieldTransforms)}function pp(t,e,n,r){return void 0===r&&(r=!1),dp(n,t.Uc(r?4:3,e))}function dp(t,e){if(vp(t=_(t)))return gp("Unsupported field value:",e,t),yp(t,e);if(t instanceof Yf)return function(t,e){if(!tp(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=dp(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=_(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return es(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ki.fromDate(t);return{timestampValue:ca(e.R,n)}}if(t instanceof ki)return n=new ki(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ca(e.R,n)};if(t instanceof Xf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Wf)return{bytesValue:ha(e.R,t._byteString)};if(t instanceof Of){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:pa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Df(t))}(t,e)}function yp(t,e){var n={};return Li(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Oi(t,(function(t,r){var i=dp(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function vp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ki||t instanceof Xf||t instanceof Wf||t instanceof Of||t instanceof Yf)}function gp(t,e,n){if(!vp(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Df(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function mp(t,e,n){if((e=_(e))instanceof Hf)return e._internalPath;if("string"==typeof e)return wp(t,e);throw Ep("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var bp=new RegExp("[~\\*/\\[\\]]");function wp(t,e,n){if(e.search(bp)>=0)throw Ep("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Hf.bind.apply(Hf,u([void 0],e.split(".")))))._internalPath}catch(r){throw Ep("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Ep(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new yi(di.INVALID_ARGUMENT,(a+=". ")+t+u)}function Ip(t,e){return t.some((function(t){return t.isEqual(e)}))}var _p=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Of(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Tp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Sp("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Tp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(_p);function Sp(t,e){return"string"==typeof e?wp(t,e):e instanceof Hf?e._internalPath:e._delegate._internalPath}var Ap=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Np=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return n(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Dp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Sp("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(_p),Dp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Np),Cp=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Ap(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Dp(n._firestore,n._userDataWriter,r.key,r,new Ap(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new yi(di.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new Dp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ap(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Dp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ap(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:kp(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function kp(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ii()}}function xp(t,e){return t instanceof Np&&e instanceof Np?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Cp&&e instanceof Cp&&t._firestore===e._firestore&&Uf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Rp(t){if(qo(t)&&0===t.explicitOrderBy.length)throw new yi(di.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Op=function(){};function Lp(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Pp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return n(e,t),e.prototype._apply=function(t){var e=rp(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new yi(di.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Bp(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(jp(r,t,l))}a={arrayValue:{values:u}}}else a=jp(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Bp(s,o),a=pp(n,"where",s,"in"===o||"not-in"===o);var f=Eo.create(i,o,a);return function(t,e){if(e.g()){var n=Bo(t);if(null!==n&&!n.isEqual(e.field))throw new yi(di.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=jo(t);null!==r&&Kp(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new yi(di.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new yi(di.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Lf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Op),Mp=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return n(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new yi(di.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new yi(di.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ro(e,n);return function(t,e){if(null===jo(t)){var n=Bo(t);null!==n&&Kp(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Lf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Mo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Op),Fp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return n(e,t),e.prototype._apply=function(t){return new Lf(t.firestore,t.converter,Qo(t._query,this.Hc,this.Jc))},e}(Op),Vp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return n(e,t),e.prototype._apply=function(t){var e=qp(t,this.type,this.Yc,this.Xc);return new Lf(t.firestore,t.converter,function(t,e){return new Mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Op),Up=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return n(e,t),e.prototype._apply=function(t){var e=qp(t,this.type,this.Yc,this.Xc);return new Lf(t.firestore,t.converter,function(t,e){return new Mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Op);function qp(t,e,n,r){if(n[0]=_(n[0]),n[0]instanceof _p)return function(t,e,n,r,i){if(!r)throw new yi(di.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=zo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(oo(e,r.key));else{var c=r.data.field(u.field);if(Gi(c))throw new yi(di.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new yi(di.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new ko(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=rp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new yi(di.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new yi(di.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ko(t)&&-1!==c.indexOf("/"))throw new yi(di.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Mi.fromString(c));if(!$i.isDocumentKey(h))throw new yi(di.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new $i(h);a.push(oo(e,l))}else{var f=pp(n,r,c);a.push(f)}}return new ko(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function jp(t,e,n){if("string"==typeof(n=_(n))){if(""===n)throw new yi(di.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ko(e)&&-1!==n.indexOf("/"))throw new yi(di.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Mi.fromString(n));if(!$i.isDocumentKey(r))throw new yi(di.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return oo(t,new $i(r))}if(n instanceof Of)return oo(t,n._key);throw new yi(di.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Df(n)+".")}function Bp(t,e){if(!Array.isArray(t)||0===t.length)throw new yi(di.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new yi(di.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Kp(t,e,n){if(!n.isEqual(e))throw new yi(di.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var zp=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ji(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ki(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(zi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ii()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Oi(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Xf(Ki(t.latitude),Ki(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Qi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Hi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Bi(t);return new ki(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Mi.fromString(t);_i(Va(n));var r=new yf(n.get(1),n.get(3)),i=new $i(n.popFirst(5));return r.isEqual(e)||bi("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Gp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Qp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return n(e,t),e.prototype.convertBytes=function(t){return new Wf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Of(this.firestore,null,e)},e}(zp),Hp=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=rp(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Wp(t,this._firestore),i=Gp(r.converter,e,n),o=ip(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,vs.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Wp(t,this._firestore);return o="string"==typeof(e=_(e))||e instanceof Hf?fp(this._dataReader,"WriteBatch.update",s._key,e,n,r):lp(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,vs.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Wp(t,this._firestore);return this._mutations=this._mutations.concat(new xs(e._key,vs.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new yi(di.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Wp(t,e){if((t=_(t)).firestore!==e)throw new yi(di.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return n(e,t),e.prototype.convertBytes=function(t){return new Wf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Of(this.firestore,null,e)},e}(zp);function Xp(t,e,n){t=Cf(t,Of);var r=Cf(t.firestore,Bf),i=Gp(t.converter,e,n);return Zp(r,[ip(rp(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,vs.none())])}function $p(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Cf(t,Of);var o=Cf(t.firestore,Bf),s=rp(o);return Zp(o,[("string"==typeof(e=_(e))||e instanceof Hf?fp(s,"updateDoc",t._key,e,n,r):lp(s,"updateDoc",t._key,e)).toMutation(t._key,vs.exists(!0))])}function Jp(t){for(var e,n,r,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=_(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||jf(s[c])||(u=s[c],c++);var h,l,f,p={includeMetadataChanges:u.includeMetadataChanges};if(jf(s[c])){var d=s[c];s[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),s[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),s[c+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof Of)l=Cf(t.firestore,Bf),f=Vo(t._key.path),h={next:function(e){s[c]&&s[c](td(l,t,e))},error:s[c+1],complete:s[c+2]};else{var y=Cf(t,Lf);l=Cf(y.firestore,Bf),f=y._query;var v=new Yp(l);h={next:function(t){s[c]&&s[c](new Cp(l,v,y,t))},error:s[c+1],complete:s[c+2]},Rp(t._query)}return function(t,e,n,r){var s=this,a=new Jl(r),u=new ul(e,a,n);return t.asyncQueue.enqueueAndForget((function(){return i(s,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=rl,[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){a.Wo(),t.asyncQueue.enqueueAndForget((function(){return i(s,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=il,[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(Kf(l),f,p,h)}function Zp(t,e){return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(n,void 0,void 0,(function(){var n;return o(this,(function(i){switch(i.label){case 0:return n=wl,[4,hf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Kf(t),e)}function td(t,e,n){var r=n.docs.get(e._key),i=new Yp(t);return new Np(t,i,e._key,r,new Ap(n.hasPendingWrites,n.fromCache),e.converter)}var ed=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return n(e,t),e.prototype.get=function(e){var n=this,r=Wp(e,this._firestore),i=new Yp(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Np(n._firestore,i,r._key,t._document,new Ap(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=rp(t)}return t.prototype.get=function(t){var e=this,n=Wp(t,this._firestore),r=new Qp(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Ii();var i=t[0];if(i.isFoundDocument())return new _p(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new _p(e._firestore,r,n._key,null,n.converter);throw Ii()}))},t.prototype.set=function(t,e,n){var r=Wp(t,this._firestore),i=Gp(r.converter,e,n),o=ip(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Wp(t,this._firestore);return o="string"==typeof(e=_(e))||e instanceof Hf?fp(this._dataReader,"Transaction.update",s._key,e,n,r):lp(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Wp(t,this._firestore);return this._transaction.delete(e._key),this},t}());function nd(){if("undefined"==typeof Uint8Array)throw new yi(di.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function rd(){if("undefined"==typeof atob)throw new yi(di.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var id=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return rd(),new t(Wf.fromBase64String(e))},t.fromUint8Array=function(e){return nd(),new t(Wf.fromUint8Array(e))},t.prototype.toBase64=function(){return rd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return nd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),od=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Qf(t=Cf(t,Bf));var n=Kf(t),r=t._freezeSettings(),i=new $l;return Gf(n,i,new Yl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Qf(t=Cf(t,Bf));var e=Kf(t),n=t._freezeSettings(),r=new $l;return Gf(e,r,new Xl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new yi(di.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new uu;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return i(e,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return lu.yt()?(e=t+"main",[4,lu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Ic(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),sd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof yf||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||wi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,i){var o;void 0===i&&(i={});var s=(t=Cf(t,Rf))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&wi("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},s),{host:e+":"+n,ssl:!1})),i.mockUserToken){var a,u;if("string"==typeof i.mockUserToken)a=i.mockUserToken,u=Zc.MOCK_USER;else{a=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=r({iss:"https://securetoken.google.com/"+n,aud:n,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},t);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(s)),""].join(".")}(i.mockUserToken,null===(o=t._app)||void 0===o?void 0:o.options.projectId);var c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new yi(di.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Zc(c)}t._credentials=new bf(new gf(a,u))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return i(e,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return[4,af(t)];case 1:return e=r.sent(),[4,cf(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Ti(t);return e.Or.delete(0),Sh(e)}(n))]}}))}))}))}(Kf(Cf(this._delegate,Bf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return i(e,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return[4,af(t)];case 1:return e=r.sent(),[4,cf(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return(e=Ti(t)).Or.add(0),[4,Ah(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Kf(Cf(this._delegate,Bf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Sf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(e,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return e=Al,[4,hf(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Kf(Cf(this._delegate,Bf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Jl(e);return t.asyncQueue.enqueueAndForget((function(){return i(n,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=function(t,e){Ti(t).Gr.add(e),e.next()},[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return i(n,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=function(t,e){Ti(t).Gr.delete(e)},[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Kf(t=Cf(t,Bf)),jf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new yi(di.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wd(this,Mf(this._delegate,t))}catch(t){throw fd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new ld(this,Ff(this._delegate,t))}catch(t){throw fd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new gd(this,function(t,e){if(t=Cf(t,Rf),_f("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new yi(di.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Lf(t,null,function(t){return new Mo(Mi.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw fd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(n,void 0,void 0,(function(){var n;return o(this,(function(i){switch(i.label){case 0:return[4,function(t){return sf(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new tf(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Kf(t),(function(n){return e(new ed(t,n))}))}(this._delegate,(function(n){return t(new ud(e,n))}))},t.prototype.batch=function(){var t=this;return Kf(this._delegate),new cd(new Hp(this._delegate,(function(e){return Zp(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new yi(di.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new yi(di.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),ad=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return n(e,t),e.prototype.convertBytes=function(t){return new id(new Wf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return ld.eu(e,this.firestore,null)},e}(zp),ud=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new ad(t)}return t.prototype.get=function(t){var e=this,n=Ed(t);return this._delegate.get(n).then((function(t){return new yd(e._firestore,new Np(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Ed(t);return n?(Tf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ed(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,u([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ed(t);return this._delegate.delete(e),this},t}(),cd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ed(t);return n?(Tf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ed(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,u([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ed(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),hd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Dp(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new vd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new ad(e),n),i.set(n,o)),o},t}();hd.su=new WeakMap;var ld=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new ad(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new yi(di.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Of(n._delegate,r,new $i(e)))},t.eu=function(e,n,r){return new t(n,new Of(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new wd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wd(this.firestore,Mf(this._delegate,t))}catch(t){throw fd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=_(t))instanceof Of&&Vf(this._delegate,t)},t.prototype.set=function(t,e){e=Tf("DocumentReference.set",e);try{return e?Xp(this._delegate,t,e):Xp(this._delegate,t)}catch(t){throw fd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?$p(this._delegate,t):$p.apply(void 0,u([this._delegate,t,e],n))}catch(t){throw fd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Zp(Cf((t=this._delegate).firestore,Bf),[new xs(t._key,vs.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pd(e),i=dd(e,(function(e){return new yd(t.firestore,new Np(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return Jp(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Cf(t,Of);var e=Cf(t.firestore,Bf),n=Kf(e),r=new Yp(e);return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(n,void 0,void 0,(function(){var n;return o(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Ti(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new yi(di.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=$h(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,uf(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Np(e,r,t._key,n,new Ap(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Cf(t,Of);var e=Cf(t.firestore,Bf);return ff(Kf(e),t._key,{source:"server"}).then((function(n){return td(e,t,n)}))}(this._delegate):function(t){t=Cf(t,Of);var e=Cf(t.firestore,Bf);return ff(Kf(e),t._key).then((function(n){return td(e,t,n)}))}(this._delegate)).then((function(t){return new yd(e.firestore,new Np(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(hd.nu(this.firestore,e)):this._delegate.withConverter(null))},t}();function fd(t,e,n){return t.message=t.message.replace(e,n),t}function pd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!jf(r))return r}return{}}function dd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=jf(t[0])?t[0]:jf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var yd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new ld(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return xp(this._delegate,t._delegate)},t}(),vd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(yd),gd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new ad(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Lp(this._delegate,function(t,e,n){var r=e,i=Sp("where",t);return new Pp(i,r,n)}(e,n,r)))}catch(e){throw fd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Lp(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Sp("orderBy",t);return new Mp(r,n)}(e,n)))}catch(e){throw fd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Lp(this._delegate,function(t){return kf("limit",t),new Fp("limit",t,"F")}(e)))}catch(e){throw fd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Lp(this._delegate,function(t){return kf("limitToLast",t),new Fp("limitToLast",t,"L")}(e)))}catch(e){throw fd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Lp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vp("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw fd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Lp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vp("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw fd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Lp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Up("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw fd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Lp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Up("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw fd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Cf(t,Lf);var e=Cf(t.firestore,Bf),n=Kf(e),r=new Yp(e);return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return i(n,void 0,void 0,(function(){var n;return o(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return i(this,void 0,void 0,(function(){var r,i,s,a,u;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Fc(t,e,!0)];case 1:return u=o.sent(),r=new pl(e,u.Bn),i=r._o(u.documents),s=r.applyChanges(i,!1),n.resolve(s.snapshot),[3,3];case 2:return a=o.sent(),u=$h(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,uf(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Cp(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Cf(t,Lf);var e=Cf(t.firestore,Bf),n=Kf(e),r=new Yp(e);return pf(n,t._query,{source:"server"}).then((function(n){return new Cp(e,r,t,n)}))}(this._delegate):function(t){t=Cf(t,Lf);var e=Cf(t.firestore,Bf),n=Kf(e),r=new Yp(e);return Rp(t._query),pf(n,t._query).then((function(n){return new Cp(e,r,t,n)}))}(this._delegate)).then((function(t){return new bd(e.firestore,new Cp(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pd(e),i=dd(e,(function(e){return new bd(t.firestore,new Cp(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Jp(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(hd.nu(this.firestore,e)):this._delegate.withConverter(null))},t}(),md=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new vd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),bd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new gd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new vd(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new md(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new vd(n._firestore,r))}))},t.prototype.isEqual=function(t){return xp(this._delegate,t._delegate)},t}(),wd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return n(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new ld(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new ld(this.firestore,void 0===t?Ff(this._delegate):Ff(this._delegate,t))}catch(t){throw fd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Cf(t.firestore,Bf),r=Ff(t),i=Gp(t.converter,e);return Zp(n,[ip(rp(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,vs.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new ld(e.firestore,t)}))},e.prototype.isEqual=function(t){return Vf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(hd.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(gd);function Ed(t){return Cf(t,Of)}var Id,_d=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Hf.bind.apply(Hf,u([void 0],t)))}return t.documentId=function(){return new t(Vi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=_(t))instanceof Hf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Td=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new ap("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new op("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new up("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cp("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new hp("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Sd={Firestore:sd,GeoPoint:Xf,Timestamp:ki,Blob:id,Transaction:ud,WriteBatch:cd,DocumentReference:ld,DocumentSnapshot:yd,Query:gd,QueryDocumentSnapshot:vd,QuerySnapshot:bd,CollectionReference:wd,FieldPath:_d,FieldValue:Td,setLogLevel:function(t){var e;e=t,vi.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new S("firestore",(function(t){return function(t,e){return new sd(t,new Bf(t,e),new od)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Sd)))})(Id=J),Id.registerVersion("@firebase/firestore","2.4.1"),J.initializeApp({apiKey:"AIzaSyDGxolS2-nqQXWNea191x3cf0eN1JHXeSk",authDomain:"library-47f2a.firebaseapp.com",projectId:"library-47f2a",storageBucket:"library-47f2a.appspot.com",messagingSenderId:"921276267687",appId:"1:921276267687:web:1fe76a7ed1753bd886af82"});const Ad=J.firestore();(async()=>{let t=(await Ad.collection("Books").get()).docs.map((t=>{const e=t.data();return{id:t.id,title:e.title,author:e.author,pages:e.pages,isRead:e.isRead}}));console.log(t);const e=document.getElementById("book-container");let n;document.getElementById("new-book-btn").addEventListener("click",(function(e){const n=document.getElementById("book-title"),o=document.getElementById("book-author"),u=document.getElementById("book-pages"),c=document.getElementById("is-read");n.validity.valueMissing||o.validity.valueMissing||u.validity.typeMismatch||u.validity.valueMissing||u.validity.rangeUnderflow?(i(),e.preventDefault()):async function(e,n,i,o){let u=new r;u.title=e,u.author=n,u.pages=i,u.isRead=o,t.push(u),await Ad.collection("Books").add({title:u.title,author:u.author,pages:u.pages,isRead:u.isRead}),s(),a()}(n.value,o.value,u.value,c.checked),i()})),s(),a();class r{title;author;pages;isRead;constructor(){}get info(){return title+" by "+author+", "+pages+", "+isRead}set title(t){this.title=t}set author(t){this.author=t}set pages(t){this.pages=t}set isRead(t){this.isRead=t}}function i(){const t=document.getElementById("book-title"),e=document.getElementById("book-author"),n=document.getElementById("book-pages"),r=document.getElementById("title-val"),i=document.getElementById("author-val"),o=document.getElementById("pages-val");t.validity.valueMissing?r.textContent="You need to enter a title":r.textContent="",e.validity.valueMissing?i.textContent="You need to enter an author":i.textContent="",n.validity.typeMismatch?o.textContent="Enter a valid number":o.textContent="",n.validity.valueMissing?o.textContent="Enter a valid number":o.textContent="",n.validity.rangeUnderflow?o.textContent="Enter a valid number":o.textContent=""}async function o(e){const n=e.target.parentElement,r=n.dataset.index,i=t[r].id;t.splice(r,1),n.parentElement.removeChild(n),await Ad.collection("Books").doc(i).delete().then((()=>{console.log("Document successfully deleted!")})).catch((t=>{console.error("Error removing document: ",t)})),Array.from(document.getElementsByClassName("book")).forEach(((t,e)=>{t.dataset.index=e}))}function s(){Array.from(document.getElementsByClassName("book")).forEach((t=>{t.parentElement.removeChild(t)})),t.forEach(((t,n)=>{const r=document.createElement("div"),i=document.createElement("h3"),o=document.createElement("p"),s=document.createElement("p"),a=document.createElement("div"),c=document.createElement("p"),h=document.createElement("input"),l=document.createElement("div");h.setAttribute("type","checkbox");const f=document.createElement("button");f.type="button",f.className="remove-btn",f.textContent="Remove Book",i.textContent=t.title,o.textContent=t.author,s.textContent=t.pages+" pages",h.name=n,!0===t.isRead?(c.textContent="Read",l.style.backgroundColor="rgb(133, 190, 133)"):(c.textContent="Not read",l.style.backgroundColor="red"),e.appendChild(r),r.className="book",r.dataset.index=n,r.appendChild(i),r.appendChild(o),r.appendChild(s),r.appendChild(a),a.appendChild(c),a.appendChild(h),a.appendChild(l),r.appendChild(f),h.addEventListener("click",u)}))}function a(){n=Array.from(document.getElementsByClassName("remove-btn")),n.forEach((t=>{t.addEventListener("click",o)}))}async function u(e){const n=e.target,r=n.parentElement.parentElement,i=t[r.dataset.index].id,o=document.querySelector('[data-index="'+r.dataset.index+'"] div div'),s=document.querySelector('[data-index="'+r.dataset.index+'"] div p');!0===n.checked&&t[r.dataset.index].isRead?(o.style.backgroundColor="red",s.textContent="Not read",t[r.dataset.index].isRead=!1,await Ad.collection("Books").doc(i).update({isRead:!1}).then((()=>{console.log("Document successfully updated!")})).catch((t=>{console.error("Error updating document: ",t)}))):(o.style.backgroundColor="rgb(133, 190, 133)",s.textContent="Read",t[r.dataset.index].isRead=!0,await Ad.collection("Books").doc(i).update({isRead:!0}).then((()=>{console.log("Document successfully updated!")})).catch((t=>{console.error("Error updating document: ",t)})))}})()})();